<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="cahies of tn: blog"><title>"JavaScript: The Definitive Guide (7th Edition)" を読んだ - cahiers of tn</title><link type=text/css rel=stylesheet href=https://ambi.github.io/css/bulma.min.css><link type=text/css rel=stylesheet href=https://ambi.github.io/css/style.css></head><body><section class=container><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class="navbar-item title" href=https://ambi.github.io/>cahiers of tn</a></div><div class=navbar-menu><div class=navbar-end><a class=navbar-item href=/posts/>Posts</a><a class=navbar-item href=/tags/>Tags</a></div></nav></section><hr><div id=main><div class=container><div class=columns><article class="column box is-8 content"><h1>"JavaScript: The Definitive Guide (7th Edition)" を読んだ</h1><section class=mb-6><h1 id=感想>感想</h1><p>David Flanagan の <a href=https://www.oreilly.com/library/view/javascript-the-definitive/9781491952016/>&ldquo;JavaScript: The Definitive Guide (7th Edition)&rdquo;</a> (O&rsquo;Reilly Media) を紙の本で買って読んだ。</p><p>&ldquo;JavaScript: The Definitive Guide&rdquo; というと定評ある JavaScript のレファレンス本だった。１つ前の 6th Edition は2011年出版で、HTML5 と ECMAScript5 に対応しており、1000ページを超えていた。それから9年。JavaScript の進化は著しく、やっと最新の JavaScript (ECMAScript2010) に対応した 7th Edition が出版された。</p><p>よい本だった。さすがに JavaScript が強力になりすぎて、完全なレファレンスマニュアルでもあったセクションはなくなった。結果的に700ページには収まっている。内容はしっかりしているし、網羅性はあるし、より細かくは <a href=https://developer.mozilla.org/>MDN</a> を参照せよということになる。最新のトピックも JavaScript の周辺ツール（ESLint、Babel、webpack、React、Flowなど）もフォローされている。</p><p>JavaScript について触るなら、この本を読んでおくのがよい。こんな分厚いものを読まなきゃいけないのか？　JavaScript が元の言語設計の失敗から変に機能追加していかなくてはならなかったこと、クライアントサイド JavaScript とサーバサイド JavaScript (Node.js) のトピックがそれぞれあることで、量が多い。これは JavaScript の責任であって本書の責任ではない。</p><p>今であれば素の JavaScript を使うより TypeScript を使うかもしれない。しかし、TypeScript 学習は基本的に JavaScript を知っている前提になっているし、結局 MDN のようなレファレンスを参照するときには JavaScript コードが出て来るので、JavaScript を知らないといけない。この本は TypeScript を取り上げず代わりに Flow を取り上げている。その理由（TypeScript は本質的に JavaScript と別言語である）は理解できるが、現実に今となっては Flow より TypeScript の方が興隆している以上、TypeScript を取り上げてほしかった。</p><p>以下、読書メモ。</p><h1 id=読書メモ>読書メモ</h1><h2 id=preface>Preface</h2><blockquote><p>Previous editions of this book included a comprehensive reference section. I no longer feel that it makes sense to include that material in printed form when it is so quick and easy to find up-to-date reference material online. If you need to look up anything related to ore or client-side JavaScript, I recommend you visit the MDN website ([https://developer.mozilla.org]). And for server-side Node APIs, I recommend you go directly to the source and consult the Node.js reference documentation ([https://nodejs.org/api]).</p></blockquote><p>以前の版の本書はレファレンスセクションも含んでいたが、オンラインで最新のレファレンスが簡単に見つかるので、やめたという。具体的には MDN と Node.js レファレンスを紹介している。MDN は確かによいサイトなんだけれど、あれは Wiki で誰でも編集できるのにいいのかなぁとは少し思う。多分、英語のオリジナルバージョンについてはきちんと管理されているんだろうけれど。ただ、日本語訳は基本的に微妙。</p><p>実際 &ldquo;JavaScript: The Definitive Guide&rdquo; は版を重ねるごとにページ数が増えていって第6版(2011)では1000ページを超えていた。しかも第6版が扱っているのは ECMAScript5 (2009)なので、クラスやアロー関数などの大規模な言語仕様追加が行われた ECMAScript 6 (2015) 以降を含んでいない。素直に第7版(2020)でレファレンスを含むと1200ページから1300ページくらいにはなるんじゃないだろうか。この選択は正しいと思う。レファレンスがないため、700ページですんでいる。</p><p>第7版の変更点については、著者のブログ記事 <a href=https://davidflanagan.com/2020/05/03/changes-in-the-seventh-edition.html>Changes in the Seventh Edition of JavaScript: The Definitive Guide · djf.log()</a> に詳細がある。</p><h2 id=1-introduction-to-javascript>1. Introduction to JavaScript</h2><h3 id=11-exploring-javascript>1.1 Exploring JavaScript</h3><p>ブラウザのデベロッパツールのコンソールか <a href=https://nodejs.org>Node</a> を使って、JavaScript を試すことができる。</p><h3 id=12-hello-world>1.2 Hello World</h3><p><code>hello.js</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Hello World!&#34;</span>);
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ node hello.js
</span></span></code></pre></div><h3 id=13-a-tour-of-javascript>1.3 A Tour of JavaScript</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// Anything following double slashes is an English-language comment.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// A variable is a symbolic name for a value.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Variables are declared with the let keyword:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>// Values can be assigned to variables with an = sign
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>x</span>  <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>x</span> <span style=color:#75715e>// =&gt; 0
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// JavaScript supports several typs of values
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;             <span style=color:#75715e>// Numbers.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.01</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;hello world&#34;</span>; <span style=color:#75715e>// Strings of text in quotation marks.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;JavaScript&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;          <span style=color:#75715e>// A Boolean value.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;          <span style=color:#75715e>// Null is a special value that means &#34;no value.&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>undefined</span>;     <span style=color:#75715e>// Undefined is another special value like null.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// JavaScript&#39;s most important datatype is the object.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>book</span> <span style=color:#f92672>=</span> {             <span style=color:#75715e>// Objcts are enclosed in curly braces.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>topic</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;JavaScript&#34;</span>, <span style=color:#75715e>// The property &#34;topic&#34; has value &#34;JavaScript.&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>edition</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>7</span>           <span style=color:#75715e>// The property &#34;edition&#34; has value 7.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>};                       <span style=color:#75715e>// The curly brace marks the end of the object.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Access the properties of an object with . or []:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>book</span>.<span style=color:#a6e22e>topic</span>                <span style=color:#75715e>// =&gt; &#34;JavaScript&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>book</span>[<span style=color:#e6db74>&#34;edition&#34;</span>]           <span style=color:#75715e>// =&gt; 7
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>book</span>.<span style=color:#a6e22e>author</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Flanagan&#34;</span>; <span style=color:#75715e>// Create new properties by assignment.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>book</span>.<span style=color:#a6e22e>contents</span> <span style=color:#f92672>=</span> {};       <span style=color:#75715e>// {} is an empty object with no propeties.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Conditionally access properties with ?. (ES2020):
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>book</span>.<span style=color:#a6e22e>contents</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>ch01</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>sect1</span> <span style=color:#75715e>// =&gt; undefined: book.contents has no ch01 property.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// JavaScript also supports arrays (numerically indexed lists) of values:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>primes</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>7</span>]; <span style=color:#75715e>// An array of 4 values, delimited with [ and ].
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>primes</span>[<span style=color:#ae81ff>0</span>]                  <span style=color:#75715e>// =&gt; 2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>primes</span>.<span style=color:#a6e22e>length</span>              <span style=color:#75715e>// =&gt; 4
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>primes</span>[<span style=color:#a6e22e>primes</span>.<span style=color:#a6e22e>length</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]    <span style=color:#75715e>// =&gt; 7
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>primes</span>[<span style=color:#ae81ff>4</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>9</span>;             <span style=color:#75715e>// Add a new element by assignment.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>primes</span>[<span style=color:#ae81ff>4</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>11</span>;            <span style=color:#75715e>// Or alter an existing element by assignment.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>empty</span> <span style=color:#f92672>=</span> [];            <span style=color:#75715e>// [] is an empty array with no elements.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>empty</span>.<span style=color:#a6e22e>length</span>               <span style=color:#75715e>// =&gt; 0
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Arrays and objects can hodlother arrays and objets.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>points</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>}
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>trial1</span><span style=color:#f92672>:</span> [[<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>2</span>], [<span style=color:#ae81ff>3</span>,<span style=color:#ae81ff>4</span>]],
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>trial2</span><span style=color:#f92672>:</span> [[<span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>3</span>], [<span style=color:#ae81ff>4</span>,<span style=color:#ae81ff>5</span>]]
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Operators act on values (the operands) to produce a new value.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Arithmetic operators are some of the simplest:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#ae81ff>3</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>                     <span style=color:#75715e>// =&gt; 5: addition
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#ae81ff>3</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>2</span>                     <span style=color:#75715e>// =&gt; 1: subtraction
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#ae81ff>3</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>                     <span style=color:#75715e>// =&gt; 6: multiplication
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#ae81ff>3</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>                     <span style=color:#75715e>// =&gt; 1.5: division
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span> <span style=color:#75715e>// =&gt; 1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#e6db74>&#34;3&#34;</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;2&#34;</span>                 <span style=color:#75715e>// =&gt; &#34;32&#34;: + adds numbrers, concatenates strings
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// JavaScript defines some shorthand arithmetic operators
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>count</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#75715e>// Define a variable
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>count</span><span style=color:#f92672>++</span>;       <span style=color:#75715e>// Increment the variable
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>count</span><span style=color:#f92672>--</span>;       <span style=color:#75715e>// Decrement the variable
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>count</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>2</span>;    <span style=color:#75715e>// Add 2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>count</span> <span style=color:#f92672>*=</span> <span style=color:#ae81ff>3</span>;    <span style=color:#75715e>// Multiply by 3
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>count</span>          <span style=color:#75715e>// =&gt; 3
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Equality and relational operators test whether two values are equal.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// unequal, less than, greater than, and so on. They evaluate to true or false.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>x</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>y</span>           <span style=color:#75715e>// =&gt; false: equality
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>x</span> <span style=color:#f92672>!==</span> <span style=color:#a6e22e>y</span>           <span style=color:#75715e>// =&gt; true: inequality
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>y</span>             <span style=color:#75715e>// =&gt; true: less-than
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>y</span>            <span style=color:#75715e>// =&gt; true: less-than or equal
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>x</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>y</span>             <span style=color:#75715e>// =&gt; false: greater-than
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>x</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>y</span>            <span style=color:#75715e>// =&gt; false: greater-than or equal
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#e6db74>&#34;two&#34;</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;three&#34;</span> <span style=color:#75715e>// =&gt; false: the two strings are different
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#e6db74>&#34;two&#34;</span> <span style=color:#f92672>&gt;</span> <span style=color:#e6db74>&#34;three&#34;</span>   <span style=color:#75715e>// =&gt; true: &#34;tw&#34; is alphabetically greater than &#34;th&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>false</span> <span style=color:#f92672>===</span> (<span style=color:#a6e22e>x</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>y</span>) <span style=color:#75715e>// =&gt; true: false is equal to false
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Logical operators combine or invert boolean values
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>(<span style=color:#a6e22e>x</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>&amp;&amp;</span> (<span style=color:#a6e22e>y</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>3</span>) <span style=color:#75715e>// =&gt; true: both comparisons are true. &amp;&amp; is AND
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>(<span style=color:#a6e22e>x</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>3</span>) <span style=color:#f92672>||</span> (<span style=color:#a6e22e>y</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>3</span>)     <span style=color:#75715e>// =&gt; false: neither comparison is true. || is OR
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>!</span>(<span style=color:#a6e22e>x</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>y</span>)             <span style=color:#75715e>// =&gt; true: ! inverts a boolean value
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Functions are parameterized bllocks of JavaScript code that we can invoke.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>plus1</span>(<span style=color:#a6e22e>x</span>) { <span style=color:#75715e>// Define a function named &#34;plus1&#34; with parameter &#34;x&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;   <span style=color:#75715e>// Return a value one larger than the value passed in
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}                   <span style=color:#75715e>// Functions are enclosed in curly braces
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>plus1</span>(<span style=color:#a6e22e>y</span>) <span style=color:#75715e>// =&gt; 4
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>square</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>x</span>) { <span style=color:#75715e>// Functions are values and can be assigned to vars
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>x</span>;          <span style=color:#75715e>// Compute the function&#39;s value
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>};                         <span style=color:#75715e>// Semicolon marks the end of the assignment.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>square</span>(<span style=color:#a6e22e>plus1</span>(<span style=color:#a6e22e>y</span>)) <span style=color:#75715e>// =&gt; 16
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>plus1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>x</span> =&gt; <span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>square</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>x</span> =&gt; <span style=color:#a6e22e>x</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// When functions are assigned to the properties of an object, we call them &#34;methods.&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>// All JavaScript objects (including arrrays) have methods:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> [];      <span style=color:#75715e>// Create an empty array
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>push</span>(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>); <span style=color:#75715e>// The push() method adds elements to an array
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>reverse</span>();     <span style=color:#75715e>// Another method: reverse the order of elements.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// We can define our own methods, too.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// The &#34;this&#34; keyword refers to the object on which the method is defined: in this case, the points array from earlier.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>points</span>.<span style=color:#a6e22e>dist</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>p1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>[<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>p2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>[<span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>p2</span>.<span style=color:#a6e22e>x</span><span style=color:#f92672>-</span><span style=color:#a6e22e>p1</span>.<span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>p2</span>.<span style=color:#a6e22e>y</span><span style=color:#f92672>-</span><span style=color:#a6e22e>p1</span>.<span style=color:#a6e22e>y</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> Math.<span style=color:#a6e22e>sqrt</span>(<span style=color:#a6e22e>a</span><span style=color:#f92672>*</span><span style=color:#a6e22e>a</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>b</span><span style=color:#f92672>*</span><span style=color:#a6e22e>b</span>);
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span><span style=color:#a6e22e>points</span>.<span style=color:#a6e22e>dist</span>() <span style=color:#75715e>// =&gt; Math.sqrt(2)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// JavaScript statements include conditionals and loops using the syntax of C, C++, Java, and other languages.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>x</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>x</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>abs</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>10</span>) <span style=color:#f92672>===</span> <span style=color:#a6e22e>abs</span>(<span style=color:#ae81ff>10</span>) <span style=color:#75715e>// =&gt; true
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>array</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>sum</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>x</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>array</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sum</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>primes</span>) <span style=color:#75715e>// =&gt; 28
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>factorial</span>(<span style=color:#a6e22e>n</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>product</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>while</span> (<span style=color:#a6e22e>n</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>product</span> <span style=color:#f92672>*=</span> <span style=color:#a6e22e>n</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>n</span><span style=color:#f92672>--</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>product</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>factorial</span>(<span style=color:#ae81ff>4</span>) <span style=color:#75715e>// =&gt; 24
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>factorial2</span>(<span style=color:#a6e22e>n</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>product</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#a6e22e>i</span><span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>n</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>product</span> <span style=color:#f92672>*=</span> <span style=color:#a6e22e>i</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>product</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>factorial2</span>(<span style=color:#ae81ff>5</span>) <span style=color:#75715e>// =&gt; 125
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Point</span> {         <span style=color:#75715e>// By convention, class names are capitalized.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) { <span style=color:#75715e>// Constructo function to initialize new instances.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>x</span>;       <span style=color:#75715e>// This keywrod is the new object being initialized.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>y</span>;
</span></span><span style=display:flex><span>  }                   <span style=color:#75715e>// No return is necessary in constructor functions.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>distance</span>() {        <span style=color:#75715e>// Method to compute distance from origin to point.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> Math.<span style=color:#a6e22e>sqrt</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>y</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Use the Point() constructor function with &#34;new&#34; to create Point objects
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>p</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Point</span>(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Now use a method of the Point object p
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>distance</span>() <span style=color:#75715e>// =&gt; Math.Sqrt(2)
</span></span></span></code></pre></div><h3 id=14-example-character-frequency-histograms>1.4 Example: Character Frequency Histograms</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DefaultMap</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Map</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>defaultValue</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>defaultValue</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>defaultValue</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>key</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>has</span>(<span style=color:#a6e22e>key</span>)) <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>super</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>key</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>defaultValue</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Histgram</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>letterCounts</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DefaultMap</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>totalLetters</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>text</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>text</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>text</span>.<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>/\s/g</span>, <span style=color:#e6db74>&#39;&#39;</span>).<span style=color:#a6e22e>toUpperCase</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>character</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>text</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>count</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>letterCounts</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>character</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>letterCounts</span>.<span style=color:#a6e22e>set</span>(<span style=color:#a6e22e>character</span>, <span style=color:#a6e22e>count</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>totalLetters</span><span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>toString</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Convert the Map to an array of [key, value] arrays
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>entries</span> <span style=color:#f92672>=</span> [...<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>letterCounts</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Sort the array by count, then alphabetically
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>entries</span>.<span style=color:#a6e22e>sort</span>((<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span>) =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>a</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>===</span> <span style=color:#a6e22e>b</span>[<span style=color:#ae81ff>1</span>]) <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>a</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>b</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>?</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>b</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>-</span> <span style=color:#a6e22e>a</span>[<span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Convert the counts to percentage
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>entry</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>entries</span>)
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>entry</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>entry</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>totalLetters</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>100</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Drop any entries less than 1%
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>entries</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>entries</span>.<span style=color:#a6e22e>filter</span>(<span style=color:#a6e22e>entry</span> =&gt; <span style=color:#a6e22e>entry</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Now convert each entry to a line of text
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>lines</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>entries</span>.<span style=color:#a6e22e>map</span>(([<span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>n</span>]) =&gt; <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>l</span><span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>${</span><span style=color:#e6db74>&#34;#&#34;</span>.<span style=color:#a6e22e>repeat</span>(Math.<span style=color:#a6e22e>round</span>(<span style=color:#a6e22e>n</span>))<span style=color:#e6db74>}</span><span style=color:#e6db74> </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>n</span>.<span style=color:#a6e22e>toFixed</span>(<span style=color:#ae81ff>2</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>%`</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>lines</span>.<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#34;\n&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// This async (Promise-returning) function creates a Histogram object,
</span></span></span><span style=display:flex><span><span style=color:#75715e>// asynchronously reads chunks of text from standard input, and adds those chunks to the histogram.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>histogramFromStdin</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>stdin</span>.<span style=color:#a6e22e>setEncoding</span>(<span style=color:#e6db74>&#39;utf-8&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>histogram</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Histgram</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> <span style=color:#66d9ef>await</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>chunk</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>stdin</span>) {<span style=color:#960050;background-color:#1e0010>†</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>histogram</span>.<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>chunk</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>histogram</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>histogramFromStdin</span>().<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>histogram</span> =&gt; { <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>histogram</span>.<span style=color:#a6e22e>toString</span>()); });
</span></span></code></pre></div><h2 id=2-lexical-structure>2. Lexical Structure</h2><h3 id=21-the-text-of-a-javascript-program>2.1 The Text of a JavaScript Program</h3><ul><li>JavaScript は大文字小文字を区別する言語。</li><li>JavaScript プログラムのトークン間のホワイトスペースは無視される。</li></ul><h3 id=22-comments>2.2 Comments</h3><ul><li><code>//</code> から改行まではコメントで、JavaScript 的に無視される。</li><li><code>/*</code> から <code>*/</code> までもコメント。</li></ul><h3 id=23-literals>2.3 Literals</h3><p><em>リテラル(literal)</em> は、プログラムで直接現れるデータ値。詳細は第3章。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#ae81ff>12</span>            <span style=color:#75715e>// number
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#ae81ff>1.2</span>           <span style=color:#75715e>// number
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#e6db74>&#34;hello world&#34;</span> <span style=color:#75715e>// string
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#e6db74>&#39;Hi&#39;</span>          <span style=color:#75715e>// string
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>true</span>          <span style=color:#75715e>// boolean
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>false</span>         <span style=color:#75715e>// boolean
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>null</span>          <span style=color:#75715e>// Absence of an object
</span></span></span></code></pre></div><h3 id=24-ideentifiers-and-reserved-words>2.4 Ideentifiers and Reserved Words</h3><p><em>識別子(identifier)</em> は、定数・変数・プロパティ・クラスなどに付ける名前。識別子は、英字・アンダースコア・ドル記号から始めて、英字・数字・アンダースコア・ドル記号が続く。</p><p>ただし、予約語は識別子として使えない。以下の語はすべて JavaScript では特別で、一部は予約語だが、一部は識別子としても使える。<code>from</code>, <code>set</code>, <code>target</code> だけは、識別子としても、安全かつすでによく使われているので例外として、ほかの以下の語は識別子として使わない方がよい。</p><pre tabindex=0><code>as
async
await
break
case
catch
class
const
continue
debugger
default
delete
do
else
enum
export
extends
false
finally
for
from
function
get
if
import
implements
in
instanceof
interface
let
new
null
of
package
private
protected
public
return
set
static
super
switch
target
this
thrwo
true
try
typeof
var
void
while
with
yield
</code></pre><h3 id=25-unicode>2.5 Unicode</h3><p>JavaScript プログラムは Unicode で書かれる。</p><p>入力が難しい Unicode 文字を書くために、4桁の16進数で <code>\uXXXX</code> または2-6桁の16進数で <code>\u{XXXXXX}</code> というエスケープシーケンスの記法がある。</p><p>Unicode 文字列は同じ文字列に対して複数の表現が可能なので、できるだけ正規化して書くべき。</p><h3 id=26-optional-semicolons>2.6 Optional Semicolons</h3><p>JavaScript はセミコロンで文を区切る。２つの文が別々の行であれば、２つの文間のセミコロンは省略できる。プログラムの終わりや綴じ波カッコ <code>}</code> の前のセミコロンも、省略できる。</p><p>次のコードで、最初のセミコロンは省略できる：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>;
</span></span></code></pre></div><p>しかし、次のコードでは、最初のセミコロンは必要：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>; <span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>;
</span></span></code></pre></div><p>JavaScript は改行を常にセミコロンとして扱うわけではない。改行をセミコロンとして扱わなければ、改行の次の非空白文字（トークン）が前の文の継続として解釈できないときだけ、改行をセミコロンとして扱う。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>a</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span>
</span></span><span style=display:flex><span><span style=color:#f92672>=</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>a</span>)
</span></span></code></pre></div><p>上のコードは次のように解釈される：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>a</span>; <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>a</span>);
</span></span></code></pre></div><p>このルールのため驚くべきことに、</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>f</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>a</span><span style=color:#f92672>+</span><span style=color:#a6e22e>b</span>).<span style=color:#a6e22e>toString</span>()
</span></span></code></pre></div><p>は次のように解釈される：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>f</span>(<span style=color:#a6e22e>a</span><span style=color:#f92672>+</span><span style=color:#a6e22e>b</span>).<span style=color:#a6e22e>toString</span>();
</span></span></code></pre></div><p>一般的に、文が <code>(</code>, <code>[</code>, <code>/</code>, <code>+</code>, <code>-</code> から始まっている場合、前の文の継続として解釈可能な可能性がある。</p><p>改行をセミコロンとして扱うルールには３つの例外がある。</p><ol><li><code>return</code>, <code>throw</code>, <code>yield</code>, <code>break</code>, <code>continue</code> 文の直後に改行があった場合、JavaScript は必ず改行をセミコロンとして扱う。</li><li><code>++</code>, <code>--</code> を後置演算子として使う場合、これらの演算子は必ずオペランドと同じ行に書かなければならない。</li><li>アロー関数の <code>=></code> は必ずパラメータリストと同じ行に書かなければならない。</li></ol><h2 id=3-types-values-and-variables>3. Types, Values, and Variables</h2><h3 id=31-overview-and-definitions>3.1 Overview and Definitions</h3><p>JavaScript の型：</p><ul><li><em>プリミティブ型(primitive types)</em>: immutable<ul><li>数字(number)</li><li>文字列(string)</li><li>真偽値(boolean)</li><li><code>null</code></li><li><code>undefined</code></li><li>シンボル(Symbol): ES6 で追加された</li></ul></li><li><em>オブジェクト型(object types)</em>: mutable. 名前と値を持つ <em>プロパティ(properties)</em> の集まり<ul><li>オブジェクト(object)</li><li>配列(array)</li><li>Set</li><li>Map</li><li>型付き配列(TypedArray)</li><li>正規表現(RegExp)</li><li>Date</li><li>Error</li></ul></li></ul><h3 id=32-numbers>3.2. Numbers</h3><p>Number は整数と近似実数を表現する型。IEEE-754標準で定義された64ビット浮動小数点数なので、<code>1.79... * 10^308</code> から <code>5 * 10^(-324)</code> まで表現できる。<code>-2^53</code> から <code>2^53</code> までの整数も表現できる。</p><p>整数リテラル：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1_000_000_000</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0xff</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0b10101</span> <span style=color:#75715e>// in ES6
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#ae81ff>0o377</span>   <span style=color:#75715e>// in ES6
</span></span></span></code></pre></div><p>浮動小数点リテラル(<code>[digits][.digits][(E|e)[(+|-)]digits]</code>)：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#ae81ff>3.14</span>
</span></span><span style=display:flex><span>.<span style=color:#ae81ff>3333</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>6.02</span><span style=color:#a6e22e>e23</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1.47</span><span style=color:#a6e22e>E</span><span style=color:#f92672>-</span><span style=color:#ae81ff>32</span>
</span></span></code></pre></div><p>JavaScript の数学関数は、オーバーフロー、アンダーフロー、ゼロ除算でエラーにはならない。正のオーバーフローのときは <code>Infinity</code>、負のオーバーフローのときは <code>-Infinity</code> という特別な値になる。アンダーフローのときは <code>0</code>、負数からのアンダーフローのときは <code>-0</code> になる。ゼロ除算のときは <code>NaN</code> になる。<code>Infinity</code>, <code>NaN</code> はグローバル定数として定義されている。</p><p><code>NaN</code> はどんな値と比較しても（<code>NaN</code> 自身と比較しても）等しくならない。<code>NaN</code> が <code>NaN</code> かどうかをチェックするためには <code>Number.isNaN(x)</code> 関数を使う。一方、<code>-0</code> は <code>+0</code> と等しい。</p><p>IEEE-754浮動小数点は2進数表現なので、<code>1/10</code>, <code>1/100</code> のような数字は正確に表現できない。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> .<span style=color:#ae81ff>3</span> <span style=color:#f92672>-</span> .<span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> .<span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> .<span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>x</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>y</span> <span style=color:#75715e>// false
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>x</span> <span style=color:#f92672>===</span> .<span style=color:#ae81ff>1</span> <span style=color:#75715e>// false
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>y</span> <span style=color:#f92672>===</span> .<span style=color:#ae81ff>1</span> <span style=color:#75715e>// true
</span></span></span></code></pre></div><p>ES2020 では、BigInt という数値型が導入された。この型は主に64ビット整数を表現できるようにするために追加された。整数リテラルの末尾に <code>n</code> を付けると、BigInt 型のリテラルになる。BigInt に対して <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>%</code>, <code>**</code> 演算子を使うことができるが、BigInt と通常の Number の組み合わせに対して演算することはできない。</p><h3 id=33-text>3.3. Text</h3><p>文字列は不可変な16ビット値の配列で、要素１つ１つが通常 Unicode 文字になる。文字列の <em>長さ(length)</em> は16ビット値の要素数。16ビット値１つで表現し切れない Unicode 文字はサロゲートペアという２つの16ビット値のペアで表現する必要がある。そのため、JavaScript の文字列の長さが 2 でも、１つの Unicode 文字しか含んでないこともある。ES6 では文字列は <em>iterable</em> になって、<code>for/of</code> ループまたは <code>...</code> 演算子を使うと、16ビット値でなく、実際の文字ごとに処理することができる。</p><p>文字列リテラルは、シングルクォートかダブルクォートかバッククォートでテキストを囲む。文字列リテラルの中のバックスラッシュ文字は特別で、エスケープシーケンスが書ける。</p><table><thead><tr><th>シーケンス</th><th>文字</th></tr></thead><tbody><tr><td><code>\0</code></td><td>NUL 文字</td></tr><tr><td><code>\b</code></td><td>バックスペース</td></tr><tr><td><code>\t</code></td><td>水平タブ</td></tr><tr><td><code>\n</code></td><td>改行</td></tr><tr><td><code>\v</code></td><td>垂直タブ</td></tr><tr><td><code>\f</code></td><td>フォームフィード</td></tr><tr><td><code>\r</code></td><td>復帰</td></tr><tr><td><code>\"</code></td><td>ダブルクォート</td></tr><tr><td><code>\'</code></td><td>シングルクォート</td></tr><tr><td><code>\\</code></td><td>バックスラッシュ</td></tr><tr><td><code>\xNN</code></td><td>16進数の Unicode 文字</td></tr><tr><td><code>\uNNNN</code></td><td>16進数の Unicode 文字</td></tr><tr><td><code>\u{N}</code></td><td>16進数の Unicode 文字</td></tr></tbody></table><p><code>+</code> 演算子で文字列を <em>結合(concatenate)</em> することができる。</p><p>ES6 以降では、バッククォートを使った <em>テンプレートリテラル(template literal)</em> が書ける。バッククォートの中で <code>${...}</code> と書くと、JavaScript 式として評価されその結果が挿入される。</p><p>ES6 では、ビルトインのタグ関数 <code>String.raw()</code> がある。<code>String.raw()</code> 関数はバッククォート内の文字列をエスケープ処理せずにそのまま返す。タグ関数については 14.5 節参照。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>String.<span style=color:#a6e22e>raw</span><span style=color:#e6db74>`\n`</span>.<span style=color:#a6e22e>length</span>
</span></span></code></pre></div><h3 id=34-boolean-values>3.4. Boolean Values</h3><p>真偽値は真 (<code>true</code>) または偽 (<code>false</code>) を表現する。</p><p><code>undefined</code>, <code>null</code>,<code>0</code>, <code>-0</code>, <code>NaN</code>, <code>""</code> は真偽値に変換すると <code>false</code> になり、また <code>false</code> のように扱われる(<em>falsy</em>)。それ以外の値はすべて真偽値に変換すると <code>true</code> になり、また <code>true</code> のように扱われる(<em>truthy</em>)。</p><h3 id=35-null-and-undefined>3.5. null and undefined</h3><p><code>null</code> はキーワードで、値がないことを示す特別な値。<code>typeof null</code> は <code>"object"</code> を返す。</p><p><code>undefined</code> はグローバル定数で、やはり値がないことを示す特別な値。まだ初期化されていない変数や、オブジェクトの存在しないプロパティを参照したときに <code>undefined</code> が返される。<code>typeof undefined</code> は <code>"undefined"</code> を返す。</p><p><code>null</code> と <code>undefined</code> は <code>==</code> で等しく扱われる（<code>===</code> では異なる）。どちらも falsy な値。どちらもプロパティやメソッドを一切持たない。</p><p>David Flanagan 曰く、<code>undefined</code> はシステムレベルの予期しないエラーとして、値がないことを示す。<code>null</code> はプログラムレベルの通常のものとして、値がないことを示す。可能なら <code>undefined</code> も <code>null</code> も利用せず、利用する場合は <code>null</code> の方を使う。</p><p>Note: <code>null</code> と <code>undefined</code> があるのはちょっと面倒。Common Lisp は <code>nil</code>、Smalltalk は <code>nil</code>、Python は <code>None</code>、Ruby は <code>nil</code> といった感じで、ほかのメジャーな言語に２種類の「値がないことを示す値」がある事例はない。値がないのでなく偽値である <code>false</code> 値はもちろん別として。これは普通なら例外を吐くような場合も、JavaScript ではブラウザのスクリプト利用用途的に例外を出さないようにした（そもそも ECMAScript の歴史を見ると、2nd Edition までは例外処理を含んでいなかった）からだろうか、と想像する。だとしても結果的には、<code>null</code> だけにした方がまだ混乱を招かなかったように思う。一言では、これは言語設計ミスと言ってよい。</p><h3 id=36-symbols>3.6. Symbols</h3><p>シンボルはプロパティ名用に ES6 で導入された。</p><p><code>Symbol()</code> 関数は、同じ引数を渡したとしても常に新しいシンボルを返す。<code>Symbol()</code> を呼ぶことで、新しいプロパティを追加して、既存の同名プロパティを上書きしてしまう心配はない。</p><p><code>Symbol.for()</code> 関数は文字列引数をとって、その文字列に関連付けたシンボルを返す。まだその文字列のシンボルが関連付いていないときだけ、新しいシンボルが生成される。</p><p>Note: いまいちこの用途が分からない。Lisp の <code>gensym</code> を含んだシンボル機能なのは分かる。最初から JavaScript にシンボル機能があって全面的に使われているなら、分かる。ただ、あとから追加された機能のせいで、すごく微妙に思える。</p><h3 id=37-the-global-object>3.7. The Global Object</h3><p>JavaScript インタープリタがスタートしたとき、新しいグローバルオブジェクトが生成され、初期プロパティがいくつか定義される：</p><ul><li><code>undefined</code>, <code>Infinity</code>, <code>NaN</code> のようなグローバル定数</li><li><code>isNaN()</code>, <code>parseInt()</code>, <code>eval()</code> のようなグローバル関数</li><li><code>Date()</code>, <code>RegExp()</code>, <code>String()</code>, <code>Object()</code>, <code>Array()</code> のようなコンストラクタ関数</li><li><code>Math</code>, <code>JSON</code> のようなグローバルオブジェクト</li></ul><p>Node では、<code>global</code> という名前のプロパティがあって、グローバルオブジェクト自身を指す。</p><p>ウェブブラウザでは、<code>window</code> オブジェクトがグローバルオブジェクトとして働く。</p><p>ES2020 では、<code>globalThis</code> というグローバルオブジェクトが定義された。</p><h3 id=38-immutable-primitive-values-and-mutable-object-references>3.8. Immutable Primitive Values and Mutable Object References</h3><p>プリミティブ値は不可変(<em>immutable</em>)である。プリミティブ値の比較は値(<em>by value</em>)で行われる。</p><p>オブジェクトは可変(<em>mutable</em>)である。オブジェクトの比較はレファレンス(<em>by reference</em>)で行われる。同じプロパティ名と値を持っていたとしても、２つのオブジェクトは異なる。</p><h3 id=39-type-conversions>3.9. Type Conversions</h3><p>JavaScript は必要な型に応じて、値を自動で変換する。</p><table><thead><tr><th>Value</th><th>to String</th><th>to Number</th><th>to Boolean</th></tr></thead><tbody><tr><td><code>undefined</code></td><td><code>"undefined"</code></td><td><code>NaN</code></td><td><code>false</code></td></tr><tr><td><code>null</code></td><td><code>"null"</code></td><td><code>0</code></td><td><code>false</code></td></tr><tr><td><code>true</code></td><td><code>"true"</code></td><td><code>1</code></td><td></td></tr><tr><td><code>false</code></td><td><code>"false"</code></td><td><code>0</code></td><td></td></tr><tr><td><code>""</code></td><td></td><td><code>0</code></td><td><code>false</code></td></tr><tr><td><code>"1.2"</code></td><td></td><td><code>1.2</code></td><td><code>true</code></td></tr><tr><td><code>"one"</code></td><td></td><td><code>NaN</code></td><td><code>true</code></td></tr><tr><td><code>0</code></td><td><code>"0"</code></td><td></td><td><code>false</code></td></tr><tr><td><code>-0</code></td><td><code>"0"</code></td><td></td><td><code>false</code></td></tr><tr><td><code>1</code></td><td><code>"1"</code></td><td></td><td><code>true</code></td></tr><tr><td><code>Infinity</code></td><td><code>"Infinity"</code></td><td></td><td><code>true</code></td></tr><tr><td><code>-Infinity</code></td><td><code>"-Infinity"</code></td><td></td><td><code>true</code></td></tr><tr><td><code>NaN</code></td><td><code>"NaN"</code></td><td></td><td><code>false</code></td></tr><tr><td><code>{}</code> (any object)</td><td><code>["object Object]"</code> (use <code>toString()</code>)</td><td><code>NaN</code> (use <code>valueOf()</code>)</td><td><code>true</code></td></tr><tr><td><code>[]</code> (empty array)</td><td><code>""</code></td><td><code>0</code></td><td><code>true</code></td></tr><tr><td><code>[9]</code> (one numeric element)</td><td><code>"9"</code></td><td><code>9</code></td><td><code>true</code></td></tr><tr><td><code>['a']</code> (any other array)</td><td>(use join())</td><td><code>NaN</code></td><td><code>true</code></td></tr><tr><td><code>function(){}</code> (any function)</td><td><code>"function(){...}"</code></td><td><code>NaN</code></td><td><code>true</code></td></tr></tbody></table><p>数字としてパースできる文字列は、その数字に変換できる。先頭と末尾のスペースは許されるが、それ以外の文字が含まれていると <code>NaN</code> に変換される。</p><p>厳格な等価演算子 <code>===</code> は、型が同じでなければ等しくならない。より柔軟な等価演算子 <code>==</code> もあり、こちらは自動で型変換されて比較する：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>null</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>undefined</span> <span style=color:#75715e>// =&gt; true
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#e6db74>&#34;0&#34;</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#75715e>// =&gt; true
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#ae81ff>0</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>false</span> <span style=color:#75715e>// =&gt; true
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#e6db74>&#34;0&#34;</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>false</span> <span style=color:#75715e>// true
</span></span></span></code></pre></div><p>明示的な型変換は、<code>Boolean()</code>, <code>Number()</code>, <code>String()</code> 関数を呼べばよい。また <code>null</code> と <code>undefined</code> 以外の値は <code>toString()</code> メソッドがあり、通常 <code>String()</code> 関数と同じ結果になる。</p><p>Number クラスの <code>toString()</code> メソッドはオプショナル引数を受け付け、変換するときの基数を指定できる。Number クラスの <code>toFixed()</code> メソッドは引数に指定した桁数の小数点以下を文字列に変換する。<code>toExponential()</code> メソッドも同様だが、指数記法になる。<code>toPrecision()</code> メソッドは引数に指定した有効数字桁の文字列に変換する。有効数字桁が整数部分を表示するのに不十分な場合、指数記法を使う。</p><p><code>Number()</code> 関数で文字列を数字に変換するとき、基数10で整数または浮動小数としてパースして、無駄な文字列は許されない。グローバル関数 <code>parseInt()</code> は整数のみをパースして、<code>parseFloat()</code> は整数と浮動小数をパースする。文字列が <code>0x</code> か <code>0X</code> で始まっていたら <code>parseInt()</code> は16進数としてパースする。<code>parseInt()</code> も <code>parseFloat()</code> も、先頭のホワイトスペースはスキップし、数字をパースしたあとの不要な文字列は無視する。最初の非空白文字が数字でなければ、<code>NaN</code> を返す。<code>parseInt()</code> はオプショナルな第２引数を受け付け、パースする基数を指定できる。</p><h3 id=310-variable-declaration-and-assignment>3.10. Variable Declaration and Assignment</h3><p>ES6 以降では、<code>let</code> キーワードで変数を宣言して、<code>const</code> キーワードで定数を宣言する：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>sum</span>; <span style=color:#75715e>// = undefined
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>message</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;hello&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>H0</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>74</span>;
</span></span></code></pre></div><p><code>let</code>, <code>const</code> はブロックスコープである。つまり、その宣言があるブロック内でのみ定義される。トップレベルで宣言した場合、グローバル変数・定数になり、そのファイル全体のスコープになる。同じスコープで同じ名前を宣言するのはシンタックスエラーだが、内側のスコープで同じな名前を宣言するのは許される。</p><p>ES6 以前の JavaScript では、<code>var</code> キーワードが唯一の変数宣言の方法だった。<code>var</code> は <code>let</code> に似ているが、いくつかの点で異なる：</p><ul><li><code>var</code> はブロックスコープを持たず、その宣言がある関数全体がスコープになる。</li><li>トップレベルで <code>var</code> で宣言した場合、グローバル変数になり、かつ、グローバルオブジェクトのプロパティになる。</li><li><code>var</code> は同じ変数名を複数宣言することができる。</li><li><code>var</code> 宣言は <em>ホイスト（巻き上げ）</em> される。つまり、<code>var</code> 宣言はその宣言がある関数のトップに巻き上げされる。</li></ul><p>ES6 では、<em>分割代入(destructuring assignment)</em> という構文がある。分割代入では、右辺の配列またはオブジェクトの要素を抽出して、右辺の変数群にセットする：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> [<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>] <span style=color:#f92672>=</span> [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>]; <span style=color:#75715e>// same as let x=1, y=2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>[<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>] <span style=color:#f92672>=</span> [<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>x</span>]; <span style=color:#75715e>// Swap the value
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>[,<span style=color:#a6e22e>x</span>,,<span style=color:#a6e22e>y</span>] <span style=color:#f92672>=</span> [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>4</span>]; <span style=color:#75715e>// x == 2; y == 4
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>[<span style=color:#a6e22e>x</span>, ...<span style=color:#a6e22e>y</span>] <span style=color:#f92672>=</span> [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>4</span>]; <span style=color:#75715e>// y == [2, 3, 4]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> [<span style=color:#a6e22e>a</span>, [<span style=color:#a6e22e>b</span>, <span style=color:#a6e22e>c</span>]] <span style=color:#f92672>=</span> [<span style=color:#ae81ff>1</span>, [<span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>2.5</span>], <span style=color:#ae81ff>3</span>]; <span style=color:#75715e>// a == 1; b == 2; c == 2.5
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> {<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>g</span>, <span style=color:#a6e22e>b</span>} <span style=color:#f92672>=</span> {<span style=color:#a6e22e>r</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.0</span>, <span style=color:#a6e22e>g</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.0</span>, <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.0</span>, <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1.0</span>}; <span style=color:#75715e>// r == 0.0, g == 0.0; b == 0.0
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>cos</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>cosine</span>, <span style=color:#a6e22e>tan</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>tangent</span> } <span style=color:#f92672>=</span> Math; <span style=color:#75715e>// Same as const cosine = Math.cos, tangent = Math.tan
</span></span></span></code></pre></div><p>Noe: <code>var</code> 変数宣言は言うまでもなく <code>let</code> によって存在価値を失った。ただ廃止にしようにも、Web 上の古い JavaScript コードを切り捨てるわけにもいかないので、ずっと残る。</p><h2 id=4-expressions-and-operators>4. Expressions and Operators</h2><h3 id=41-primary-expressions>4.1 Primary Expressions</h3><p><em>原始式 (primary expressions)</em> は、定数、リテラル、<code>this</code>、変数参照のいずれか。原始式は、ほかの式を含まない。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ae81ff>1.23</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;hello&#34;</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>/pattern/</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>this</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>i</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>sum</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>undefined</span>
</span></span></code></pre></div><h3 id=42-object-and-array-initializers>4.2 Object and Array Initializers</h3><p><em>オブジェクト初期化子(object initializers)</em> と <em>配列初期化子(array initalizers)</em> は、オブジェクトまたは配列を生成する式である。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>[]
</span></span><span style=display:flex><span>[<span style=color:#ae81ff>1</span><span style=color:#f92672>+</span><span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span><span style=color:#f92672>+</span><span style=color:#ae81ff>4</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{}
</span></span><span style=display:flex><span>{ <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>2.3</span>, <span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1.2</span> }
</span></span></code></pre></div><h3 id=43-function-definition-expressions>4.3 Function Definition Expressions</h3><p><em>関数定義式(function definition expressions)</em> は、JavaScript を定義して返す。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>square</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>x</span>) { <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>x</span>; }
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>x</span>) =&gt; { <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>x</span>; }
</span></span></code></pre></div><h3 id=44-property-access-expressions>4.4 Property Access Expressions</h3><p><em>プロパティアクセス式(property access expressions)</em> は、オブジェクトのプロパティや配列の要素の値にアクセスする。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>expression</span> . <span style=color:#a6e22e>identifier</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>expression</span> [ <span style=color:#a6e22e>expression</span> ]
</span></span></code></pre></div><p>ES2020 ではオプショナルチェーニングをサポートする。これは左辺が <code>null</code> や <code>undefined</code> のとき、右辺のプロパティアクセスをやめて <code>undefined</code> を返す：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>expression</span> <span style=color:#f92672>?</span>. <span style=color:#a6e22e>identifier</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>expression</span> <span style=color:#f92672>?</span>.[ <span style=color:#a6e22e>expression</span> ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span> };
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>b</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>d</span> <span style=color:#75715e>// =&gt; undefined
</span></span></span></code></pre></div><p>上の例で <code>(a.b?.c).d</code> は <code>undefined.d</code> に評価された結果 <code>TypeError</code> になるが、カッコのない <code>a.b?.c.d</code> は <code>?.</code> が short-circuit であるため <code>undefined</code> を返す。</p><h3 id=45-invocation-expressions>4.5 Invocation Expressions</h3><p><em>呼び出し式(invocation expressions)</em> は、関数・メソッドを呼び出す構文である。ｓ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>f</span>(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>Math.<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>z</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>sort</span>()
</span></span></code></pre></div><p>ES2020 では条件付き呼び出しが行える。これは左辺が <code>null</code> または <code>undefined</code> のときには、関数呼び出しをせず右辺も評価せず <code>undefined</code> を返す：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>log</span><span style=color:#f92672>?</span>.(<span style=color:#a6e22e>x</span>)
</span></span></code></pre></div><h3 id=46-object-creation-expressions>4.6 Object Creation Expressions</h3><p><em>オブジェクト生成式(object creation expressions)</em> は、新しいオブジェクトを生成して、関数（コンストラクタ）を呼び出してプロパティの初期化を行う。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>new</span> Object()
</span></span><span style=display:flex><span><span style=color:#66d9ef>new</span> Object
</span></span><span style=display:flex><span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Point</span>(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>)
</span></span></code></pre></div><p>Note: オブジェクト生成式はいるのか？　無意味に C++/Java の構文を真似ているだけじゃないか？</p><h3 id=47-operator-overview>4.7 Operator Overview</h3><table><thead><tr><th>Precedence</th><th>Operator</th><th>Operation</th><th>A</th><th>N</th><th>Types</th></tr></thead><tbody><tr><td>1</td><td><code>++</code></td><td>Pre/post increment</td><td>R</td><td>1</td><td>lval -> num</td></tr><tr><td>1</td><td><code>--</code></td><td>Pre/post decrement</td><td>R</td><td>1</td><td>lval -> num</td></tr><tr><td>1</td><td><code>-</code></td><td>負数</td><td>R</td><td>1</td><td>num -> num</td></tr><tr><td>1</td><td><code>+</code></td><td>数字への変換</td><td>R</td><td>1</td><td>any -> num</td></tr><tr><td>1</td><td><code>~</code></td><td>ビット反転</td><td>R</td><td>1</td><td>int -> int</td></tr><tr><td>1</td><td><code>!</code></td><td>真理値の反転</td><td>R</td><td>1</td><td>bool -> bool</td></tr><tr><td>1</td><td><code>delete</code></td><td>プロパティの削除</td><td>R</td><td>1</td><td>lval -> bool</td></tr><tr><td>1</td><td><code>typeof</code></td><td>型名</td><td>R</td><td>1</td><td>any -> str</td></tr><tr><td>1</td><td><code>void</code></td><td>undefined を返す</td><td>R</td><td>1</td><td>any -> undef</td></tr><tr><td>2</td><td><code>**</code></td><td>累乗</td><td>R</td><td>2</td><td>num, num -> num</td></tr><tr><td>3</td><td><code>*</code>, <code>/</code>, <code>%</code></td><td>乗算・除算・剰余</td><td>L</td><td>2</td><td>num, num -> num</td></tr><tr><td>4</td><td><code>+</code>, <code>-</code></td><td>加算・減算</td><td>L</td><td>2</td><td>num, num -> num</td></tr><tr><td>4</td><td><code>+</code></td><td>文字列結合</td><td>L</td><td>2</td><td>str, str -> num</td></tr><tr><td>5</td><td><code>&lt;&lt;</code></td><td>左シフト</td><td>L</td><td>2</td><td>int, int -> num</td></tr><tr><td>5</td><td><code>>></code></td><td>符号付き右シフト</td><td>L</td><td>2</td><td>int, int -> num</td></tr><tr><td>5</td><td><code>>>></code></td><td>ゼロ埋め右シフト</td><td>L</td><td>2</td><td>int, int -> num</td></tr><tr><td>6</td><td><code>&lt;</code>, <code>&lt;=</code>, <code>></code>, <code>>=</code></td><td>数字の比較</td><td>L</td><td>2</td><td>num, num -> bool</td></tr><tr><td>6</td><td><code>&lt;</code>, <code>&lt;=</code>, <code>></code>, <code>>=</code></td><td>文字列の比較</td><td>L</td><td>2</td><td>str, str -> bool</td></tr><tr><td>6</td><td><code>instanceof</code></td><td>オブジェクトクラスのテスト</td><td>L</td><td>2</td><td>obj, func -> bool</td></tr><tr><td>6</td><td><code>in</code></td><td>プロパティ存在のテスト</td><td>L</td><td>2</td><td>any, obj -> bool</td></tr><tr><td>7</td><td><code>==</code></td><td>非厳格な等価</td><td>L</td><td>2</td><td>any, any -> bool</td></tr><tr><td>7</td><td><code>!=</code></td><td>非厳格な非等価</td><td>L</td><td>2</td><td>any, any -> bool</td></tr><tr><td>7</td><td><code>===</code></td><td>厳格な等価</td><td>L</td><td>2</td><td>any, any -> bool</td></tr><tr><td>7</td><td><code>!==</code></td><td>厳格な非等価</td><td>L</td><td>2</td><td>any, any -> bool</td></tr><tr><td>8</td><td><code>&</code></td><td>ビット AND</td><td>L</td><td>2</td><td>int, int -> int</td></tr><tr><td>9</td><td><code>^</code></td><td>ビット XOR</td><td>L</td><td>2</td><td>int, int -> int</td></tr><tr><td>10</td><td>`</td><td>`</td><td>ビット OR</td><td>L</td><td>2</td></tr><tr><td>11</td><td><code>&&</code></td><td>論理 AND</td><td>L</td><td>2</td><td>any, any -> any</td></tr><tr><td>12</td><td>`</td><td></td><td>`</td><td>論理 OR</td><td>L</td></tr><tr><td>13</td><td><code>??</code></td><td>１つ目の定義されたオペランド</td><td>L</td><td>2</td><td>any, any -> any</td></tr><tr><td>14</td><td><code>?:</code></td><td>条件式</td><td>R</td><td>2</td><td>any, any -> any</td></tr><tr><td>15</td><td><code>=</code></td><td>変数・プロパティへの代入</td><td>R</td><td>2</td><td>lval, any -> any</td></tr><tr><td>15</td><td><code>**=</code>, <code>*=</code>, <code>/=</code>, <code>%=</code>, <code>+=</code>, <code>-=</code>, <code>&=</code>, <code>^=</code>, `</td><td>=<code>, </code>&#171;=<code>, </code>&#187;=<code>, </code>&#187;>=`</td><td>演算と代入</td><td>R</td><td>2</td></tr><tr><td>16</td><td><code>,</code></td><td>右辺を返す</td><td>L</td><td>2</td><td>any, any -> any</td></tr></tbody></table><p>Note: そういえば JavaScript には演算子オーバーロードがない。これは結構微妙なんじゃないか。その一方で <code>delete</code> まで演算子なので、行列演算に <code>+</code> は使えないし、独自コレクションクラスの要素削除に <code>delete</code> は使えない。</p><h3 id=48-arithmetic-expressions>4.8 Arithmetic Expressions</h3><p><code>+</code>, <code>-</code>, <code>++</code>, <code>--</code>, <code>&</code>, <code>|</code>, <code>^</code>, <code>~</code>, <code>&lt;&lt;</code>, <code>>></code>, <code>>>></code>。省略。</p><h3 id=49-relational-expressions>4.9 Relational Expressions</h3><p><code>==</code>, <code>===</code>, <code>!=</code>, <code>!==</code>, <code>&lt;</code>, <code>></code>, <code>&lt;=</code>, <code>>=</code>, <code>in</code>, <code>instanceof</code>。省略。</p><h3 id=410-logical-expressions>4.10 Logical Expressions</h3><p><code>&&</code>, <code>||</code>, <code>!</code>。省略。</p><h3 id=411-assignment-expressions>4.11 Assignment Expressions</h3><p><code>=</code>, <code>+=</code>, <code>-=</code>, <code>*=</code>, <code>/=</code>, <code>%=</code>, <code>**=</code>, <code>&lt;&lt;=</code>, <code>>>=</code>, <code>>>>=</code>, <code>&=</code>, <code>|=</code>, <code>^=</code>。省略。</p><h3 id=412-evaluation-expressions>4.12 Evaluation Expressions</h3><p><code>eval()</code>。省略。</p><h3 id=413-miscellaneous-operators>4.13 Miscellaneous Operators</h3><p><code>?:</code>, <code>??</code>, <code>typeof</code>, <code>delete</code>, <code>await</code>, <code>void</code>, <code>,</code>。省略。</p><h2 id=5-statements>5. Statements</h2><h3 id=51-expression-statements>5.1 Expression Statements</h3><p>JavaScript の一番シンプルな文は、（副作用を持つ）式。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>greeting</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Hello &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>name</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>i</span> <span style=color:#f92672>*=</span> <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>counter</span><span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>delete</span> <span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>debugMessage</span>);
</span></span></code></pre></div><h3 id=52-compound-and-empty-statements>5.2 Compound and Empty Statements</h3><p><em>文ブロック(statement block)</em> は波カッコで複数の文を囲って、複数の文を１つの <em>複合文(compound statement)</em> にする。文ブロックの終わりにはセミコロンを付けない。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>PI</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cx</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>cos</span>(<span style=color:#a6e22e>x</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;cos(n) = &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>cx</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=53-conditionals>5.3 Conditionals</h3><p><code>if</code> 文は、 <code>expression</code> を評価してその結果が truthy なときだけ <code>statement1</code> が実行される。<code>else</code> が続く場合には、<code>expression</code> が falsey なときだけ <code>statement2</code> が実行される。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>expression</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>statement1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>expression</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>statement1</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>statement2</span>
</span></span></code></pre></div><p><code>switch</code> 文は、<code>expression</code> を評価してその結果が <code>case</code> 式と等値 (<code>===</code>) のときだけその <code>case</code> 文を実行する。<code>expression</code> がどの <code>case</code> 式と一致せず <code>default</code> 文があれば <code>default</code> 文を実行する。<code>case</code> 文の終わりに <code>break</code> 文を付与しなければ、fall through して下の文に進む。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>expression</span>) {
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#a6e22e>expr1</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Execute code block #1.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#a6e22e>expr2</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Execute code block #2.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Execute clode block #4.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=54-loops>5.4 Loops</h3><p><code>while</code> 文は、<code>expression</code> を評価してその結果が truthy なら <code>statement</code> を実行して、それを <code>expression</code> が truthy の間繰り返す。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>while</span> (<span style=color:#a6e22e>expression</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>statement</span>
</span></span></code></pre></div><p><code>do/while</code> 文は、先に１度だけ <code>statement</code> を実行してから、あとは <code>while</code> 文と同じだ。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>statement</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> (<span style=color:#a6e22e>expression</span>);
</span></span></code></pre></div><p><code>for</code> 文は、まず <code>initialize</code> 式を実行する。それから <code>test</code> を評価して truthy の間、<code>statement</code> を実行して <code>increment</code> を実行する。<code>initialize</code>, <code>test</code>, <code>increment</code> は省略できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>for</span> (<span style=color:#a6e22e>initialize</span>; <span style=color:#a6e22e>test</span>; <span style=color:#a6e22e>increment</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>statement</span>
</span></span></code></pre></div><p><code>for/of</code> 文 (ES6) は、<em>iterable</em> なオブジェクト（配列、文字列、セット、マップなど） <code>object</code> の要素を１つ１つ取り出して <code>variable</code> にセットして、<code>statement</code> を実行して繰り返す。変数 <code>variable</code> の前には <code>let</code>, <code>const</code>, <code>var</code> で宣言を付けることもできる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>for</span> (<span style=color:#a6e22e>variable</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>object</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>statement</span>
</span></span></code></pre></div><p><code>for/in</code> 文は、任意のオブジェクト <code>object</code> のプロパティ名を１つ１つ取り出して <code>variable</code> にセットして、<code>statmenet</code> を実行して繰り返す。変数 <code>variable</code> の前には <code>let</code>, <code>const</code>, <code>var</code> で宣言を付けることもできる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>for</span> (<span style=color:#a6e22e>variable</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>object</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>statement</span>
</span></span></code></pre></div><h3 id=55-jumps>5.5 Jumps</h3><p>任意の文は、識別子とコロンで <em>ラベル(label)</em> を付けることができる。<code>break</code> または <code>continue</code> 文でラベル名を指定することで、ラベル付けした文に対して <code>break</code> または <code>continue</code> を実行することができる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>identifier</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>statement</span>
</span></span></code></pre></div><p><code>break</code> 文は、最も内側で囲まれているループまたは <code>switch</code> 文から抜ける。ラベル名を指定した <code>break</code> 文は、ラベルを付けた文から抜ける。</p><p><code>continue</code> 文は、最も内側で囲まれているループの次の繰り返しまでスキップする。<code>for</code> 文の <code>increment</code> は実行される。ラベル名を指定した <code>continue</code> 文は、ラベルを付けたループの次の繰り返しまでスキップする。</p><p>関数定義内の <code>return</code> 文は、その関数を終了して <code>expression</code> を返す。<code>expression</code> を省略すると <code>undefined</code> を返す。<code>return</code> がないまま関数の終わりに来た場合も、<code>unefined</code> を返す。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>return</span> <span style=color:#a6e22e>expression</span>;
</span></span></code></pre></div><p>関数定義内の <code>yield</code> 文 (ES6) は、<code>return</code> 文に近く、関数から値を返す代わりに、ジェネレータ関数で次の値を生成する。</p><p><code>throw</code> 文は、<code>expression</code> を例外として投げる。例外が投げられると、処理は中断して、最も内側の例外ハンドラまでジャンプする。例外ハンドラがなければ、エラーとして扱われユーザに報告される。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>throw</span> <span style=color:#a6e22e>expression</span>;
</span></span></code></pre></div><p><code>try/catch/finally</code> 文は例外ハンドラで、<code>try</code> 節の <code>statement1</code> を実行する。<code>try</code> 節の中で例外が投げられると、<code>catch</code> 節でその例外を変数 <code>e</code> にセットしてハンドリングして <code>statement2</code> を実行する。<code>finally</code> 節の <code>statement3</code> は、例外が発生してもしなくとも、<code>return</code>, <code>break</code>, <code>continue</code> が呼ばれたとしても、<code>try/catch</code> の処理のあとに最後に実行される。<code>catch</code> 節と <code>finally</code> 節は省略可能。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>statement1</span>
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>e</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>statement2</span>
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>finally</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>statement3</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Note: 例外クラスごとに <code>catch</code> を振り分ける機能はない。</p><h3 id=56-miscellaneous-statements>5.6 Miscellaneous Statements</h3><p><code>with</code> 文は、指定したオブジェクト <code>object</code> のプロパティを変数スコープに加えて <code>statement</code> を実行する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>with</span> (<span style=color:#a6e22e>object</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>statement</span>
</span></span></code></pre></div><p><code>debugger</code> 文は、通常何もしない。デバッガプログラムが動いているときには、インタープリタはデバッガのブレークポイントとして処理してくれることを期待する。</p><p><code>"use strict"</code> ディレクティブは ES5 で導入された。<code>"use strict"</code> ディレクティブは、スクリプトの最初か関数ボディの最初にのみ置くことができて、その範囲のコードが <em>strict</em> であることを意味する。strict モードは次のような制限がある：</p><ul><li><code>with</code> 文は、許されない。</li><li>すべての変数は、宣言しなければならない。</li><li>メソッドでなく関数として呼び出したときには、<code>tihs</code> は <code>undefined</code> になる。</li><li>書き込み可能でないプロパティへの代入や、拡張可能でないオブジェクトへのプロパティ追加は、TypeError になる。</li><li><code>eval()</code> に渡すコードは、変数の宣言や関数の定義ができない。</li><li>関数の Arguments オブジェクトは、関数に渡された値の静的なコピーになる。</li><li><code>delete</code> 式に非修飾の識別子（変数、関数、関数パラメータなど）を渡すと、SyntaxError になる。</li><li>設定可能でないプロパティを削除しようとすると、TypeError になる。</li><li>同名のプロパティを複数回定義するようなオブジェクトリテラルは、SyntaxError になる。</li><li>同名のパラメータ名を複数回定義するような関数宣言は、SyntaxError になる。</li><li>8進数リテラルは、許されない。</li><li><code>eval</code> や <code>arguments</code> はキーワードのように扱われ、値を変更することは許されない。</li><li><code>argguments.caller</code> と <code>arguments.callee</code> は、TYpeError になる。</li></ul><h3 id=57-declarations>5.7 Declarations</h3><p><code>const</code>, <code>let</code>, <code>var</code> 宣言は3.10節で扱った。</p><p><code>function</code> 宣言は第8章で扱う。</p><p><code>class</code> 宣言は第9章で扱う。</p><p><code>import</code>, <code>export</code> 宣言は第10章で扱う。</p><h2 id=6-objects>6. Objects</h2><h3 id=61-introduction-to-objects>6.1 Introduction to Objects</h3><p>オブジェクトは、名前と値からなる <em>プロパティ(property)</em> の順序なし集合である。オブジェクトは自身のプロパティのほかにも、プロトタイプという別のオブジェクトのプロパティも継承する。</p><h3 id=62-creating-objects>6.2 Creating Objects</h3><p>オブジェクトの生成は、オブジェクトリテラル、<code>new</code> キーワード、<code>Object.create()</code> 関数を使って行える。</p><p><em>オブジェクトリテラル(object literal)</em> は、<code>name: value</code> ペアをコンマで区切られたリストで、波カッコで囲んだもの。プロパティ名は JavaScript 識別子か文字列リテラルである。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>empty</span> <span style=color:#f92672>=</span> {};
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>point</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span> };
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>book</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;main title&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;JavaScript&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;sub-title&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;The Definitive Guide&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;all audiences&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>author</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>firstname</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;David&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>surname</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Flanagan&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p><code>new</code> 演算子は、コンストラクタ関数呼び出しを続けて、新しいオブジェクトを作成して初期化する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>o</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Object();
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Array();
</span></span></code></pre></div><p><code>Object.create()</code> は、第1引数をプロトタイプとして新しいオブジェクトを作成する。プロトタイプがないオブジェクトを作成したいときには、<code>null</code> を引数に渡す（ただしこれは <code>toString()</code> のようなメソッドも含まない）。通常の空オブジェクト <code>{}</code> を生成したいときには、<code>Object.prototype</code> を引数に渡す。<code>Object.create()</code> の用途の１つは、ライブラリ関数にオブジェクトを渡すとき、望まない変更がオブジェクトに行われないように、コピーを渡すこと。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>o1</span> <span style=color:#f92672>=</span> Object.<span style=color:#a6e22e>create</span>({<span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>2</span>});
</span></span><span style=display:flex><span><span style=color:#a6e22e>o1</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>o1</span>.<span style=color:#a6e22e>y</span> <span style=color:#75715e>// =&gt; 3
</span></span></span></code></pre></div><h3 id=63-querying-and-setting-properties>6.3 Querying and Setting Properties</h3><p>プロパティの値を取得するためには、ドット(<code>.</code>)または角カッコ(<code>[]</code>)演算子を使う。ドット演算子の場合、右辺はプロパティ名の識別子でなければならない。角カッコ演算子の場合、カッコ内の値は評価した結果がプロパティ名になるような式でなければならない。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>author</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>book</span>.<span style=color:#a6e22e>author</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>title</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>book</span>[<span style=color:#e6db74>&#34;main title&#34;</span>];
</span></span></code></pre></div><p>プロパティを作成したりセットしたりするには、左辺にドットまたは角カッコを使ってプロパティを指定して、代入式を書く。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>book</span>.<span style=color:#a6e22e>edition</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>7</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>book</span>[<span style=color:#e6db74>&#34;main title&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ECMAScript&#34;</span>;
</span></span></code></pre></div><p>存在しないプロパティを取得しようとすることは、エラーでない。<code>undefined</code> を返す。しかし、存在しないオブジェクト(<code>null</code>, <code>undefined</code>)のプロパティを取得しようとすることは、エラーになる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>book</span>.<span style=color:#a6e22e>subtitle</span> <span style=color:#75715e>// =&gt; undefined
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>book</span>.<span style=color:#a6e22e>subtitle</span>.<span style=color:#a6e22e>length</span> <span style=color:#75715e>// !TypeError
</span></span></span></code></pre></div><h3 id=64-deleting-properties>6.4 Deleting Properties</h3><p><code>delete</code> 演算子は、オブジェクトからプロパティを削除する。<code>delete</code> は、削除に成功したか、削除に意味がなかった場合（存在しないプロパティを削除しようとしたなど）、<code>true</code> を返す。<em>configurable</em> 属性が <code>false</code> なプロパティを削除しようとすると失敗して、strict モードでは TypeError になり、non-strict モードでは <code>false</code> を返す。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>delete</span> <span style=color:#a6e22e>book</span>.<span style=color:#a6e22e>author</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>delete</span> <span style=color:#a6e22e>book</span>[<span style=color:#e6db74>&#34;main title&#34;</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>delete</span> <span style=color:#ae81ff>1</span>; <span style=color:#75715e>// =&gt; true: nonsense, but true anyway
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>delete</span> Object.<span style=color:#a6e22e>prototype</span>; <span style=color:#75715e>// =&gt; !TypeError or false
</span></span></span></code></pre></div><h3 id=65-testing-properties>6.5 Testing Properties</h3><p>オブジェクトがある名前のプロパティ名を持つかは、<code>in</code> 演算子、<code>hasOwnProperty()</code> メソッド、<code>propertyIsEnumerable()</code> メソッドで調べられる。</p><p><code>in</code> 演算子は、右辺のオブジェクトが左辺のプロパティ名を持つかどうかを返す。</p><p><code>hasOwnProperty()</code> メソッドは、オブジェクトが引数のプロパティ名を自身で持つかどうかを返す。継承したプロパティの場合は <code>false</code> を返す。</p><p><code>propertyIsEnumerable()</code> メソッドは、オブジェクトが引数のプロパティ名を自身で持ち、かつ、<em>enumerable</em> が <code>true</code> であるかどうかを返す。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>o</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span> };
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;x&#34;</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>o</span> <span style=color:#75715e>// =&gt; true
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>hasOwnProperty</span>(<span style=color:#e6db74>&#34;x&#34;</span>) <span style=color:#75715e>// =&gt; true
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>propertyIsEnumerable</span>(<span style=color:#e6db74>&#34;x&#34;</span>) <span style=color:#75715e>// =&gt; true
</span></span></span></code></pre></div><h3 id=66-enumerating-properties>6.6 Enumerating Properties</h3><p>オブジェクトの全プロパティを反復処理したいときには、<code>for/in</code> ループ、<code>Object.keys()</code> メソッド、<code>Object.getOwnPropertyNames()</code> メソッド、<code>Object.getOwnPropertySymbols()</code> メソッド、<code>Reflect.ownKeys()</code> メソッドが使える。</p><p>ES6 は <code>Object.keys()</code> などのメソッドのプロパティ順を定義している。</p><ol><li>非負整数が名前の文字列プロパティ。数値の昇順で並ぶ。</li><li>ほかの文字列プロパティ。オブジェクトに追加・定義された順序で並ぶ。</li><li>Symbol プロパティ。オブジェクトに追加された順序で並ぶ。</li></ol><h3 id=67-extending-objects>6.7 Extending Objects</h3><p><code>Object.assign()</code> メソッドは、オブジェクトのプロパティを別のオブジェクトにコピーする。第1引数のオブジェクトに対して、第2引数のオブジェクトの enumerable な自身のプロパティをコピーして、第3引数のオブジェクトの enumerable な自身のプロパティをコピーして……と行う。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>Object.<span style=color:#a6e22e>assgin</span>(<span style=color:#a6e22e>o</span>, <span style=color:#a6e22e>defaults</span>); <span style=color:#75715e>// overwrites everything in o with defaults
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>o</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Objet</span>.<span style=color:#a6e22e>assign</span>({}, <span style=color:#a6e22e>defaults</span>, <span style=color:#a6e22e>o</span>); <span style=color:#75715e>// create a new object, copy defaults into it, and override defaults with properties in o
</span></span></span></code></pre></div><h3 id=68-serializing-objects>6.8 Serializing Objects</h3><p><code>JSOn.stringify()</code> と <code>JSON.parse()</code> は、JavaScript オブジェクトを JSON 形式でシリアライズしたりデシリアライズしたりする。JSON 構文は、JavaScript 構文のサブセットで、すべての JavaScript の値を表現できるわけではない。オブジェクト、配列、文字列、有限数、<code>true</code>、<code>false</code>、<code>null</code> はサポートしている。<code>NaN</code>, <code>Infinity</code>, <code>-Infinity</code> はサポートしておらず、<code>null</code> にシリアライズされる。Date オブジェクトは ISO 形式の日付文字列にシリアライズされる。関数、RegExp、Error オブジェクト、<code>undefined</code> はシリアライズできない。オブジェクトは、enumerable な自身のプロパティしかシリアライズされない。</p><h3 id=69-object-methods>6.9 Object Methods</h3><p>ほとんどすべての JavaScript オブジェクトは <code>Object.prototype</code> を継承している。<code>Object.prototype</code> はいくつかのメソッドを定義している。</p><p><code>toString()</code> メソッドは、オブジェkツオの値を表現した文字列を返す。</p><p><code>toLocaleString()</code> メソッドは、オブジェクトの文字列をローカライズした表現で返す。デフォルトでは <code>toString()</code> を呼ぶだけ。</p><p><code>valueOf()</code> メソッドは、文字列以外のプリミティブな型（数字など）に変換する必要があるときに呼ばれる。デフォルトの <code>valueOf()</code> メソッドは何もしない。Date クラスの <code>valueOf()</code> は、日付を数字に変換する。</p><p><code>toJSON()</code> メソッドは、デフォルトでは定義されていない。<code>JSON.stringify()</code> メソッドは、シリアライズするときに <code>toJSON()</code> メソッドがあるかを調べて、あれば <code>toJSON()</code> メソッドを呼んでシリアライズする。</p><h3 id=610-extended-object-literal-syntax>6.10 Extended Object Literal Syntax</h3><p>最近のバージョンの JavaScript は、オブジェクトリテラル構文を拡張している。</p><p>ES6 では、プロパティ名と値の変数が同名のときには、コロンを省略して簡略化できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>o1</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>y</span> };
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>o2</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span> };
</span></span></code></pre></div><p>ES6 では、<em>算出プロパティ(computed property)</em> という仕組みによって、動的に評価されたプロパティ名を使うことができる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>PROPERTY_NAME</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;p1&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>computePropertyName</span>() { <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;p&#34;</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>; }
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>p</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  [<span style=color:#a6e22e>PROPERTY_NAME</span>]<span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>  [<span style=color:#a6e22e>computePropertyName</span>()]<span style=color:#f92672>:</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>ES6 では、シンボルをプロパティ名に使うことができる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>extension</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Symbol</span>(<span style=color:#e6db74>&#34;my extension symbol&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>o</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  [<span style=color:#a6e22e>extension</span>]<span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>ES2018 では、<em>スプレッド演算子(spread operator)</em> <code>...</code> を使うことで、既存のオブジェクトのプロパティをコピーすることができる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>position</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span> };
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>dimensions</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>100</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>75</span> };
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>rectr</span> <span style=color:#f92672>=</span> { ...<span style=color:#a6e22e>position</span>, ...<span style=color:#a6e22e>dimensions</span> };
</span></span></code></pre></div><p>ES6 では、メソッドの定義を簡略化できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>square</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>area</span>() { <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>side</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>side</span>; },
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>side</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>ES5 では、<em>アクセサプロパティ(accessor property)</em> によって、プロパティのゲット・セット時にメソッドを呼び出せる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>o</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>dataProp</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>value</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>get</span> <span style=color:#a6e22e>accessorProp</span>() { <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>dataProp</span>; },
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>set</span> <span style=color:#a6e22e>accessorProp</span>(<span style=color:#a6e22e>value</span>) { <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>dataProp</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>value</span>; }
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h2 id=7-arrays>7. Arrays</h2><h3 id=71-creating-arrays>7.1 Creating Arrays</h3><p>要素をコンマで区切って角カッコで囲むと、配列リテラルによる新しい配列を作ることができる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>empty</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>primes</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>11</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>misc</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>1.1</span>, <span style=color:#66d9ef>true</span>, <span style=color:#e6db74>&#34;a&#34;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>count</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>1</span>,,<span style=color:#ae81ff>3</span>];
</span></span></code></pre></div><p>ES6 以降では、スプレッド演算子 <code>...</code> を使うことで、配列リテラルの中に別の配列要素を含めることができる。スプレッド演算子は配列のシャローコピーを作るのに便利。スプレッド演算子は任意の iterable オブジェクトに対して動く。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0</span>, ...<span style=color:#a6e22e>a</span>, <span style=color:#ae81ff>4</span>]; <span style=color:#75715e>// b == [0, 1, 2, 3, 4]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>copy</span> <span style=color:#f92672>=</span> [...<span style=color:#a6e22e>a</span>];
</span></span></code></pre></div><p><code>Array()</code>コンストラクタを使っても配列を作ることができる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Array(); <span style=color:#75715e>// empty array
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Array(<span style=color:#ae81ff>10</span>); <span style=color:#75715e>// length=10
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Array(<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#34;testing, testing&#34;</span>); <span style=color:#75715e>// two or more elements
</span></span></span></code></pre></div><p>ES6 以降では、<code>Array.of()</code> 関数を使って、引数をそのまま配列要素として配列を作ることができる。<code>Array()</code> コンストラクタは２つ以上の引数があるときだけだが、<code>Arary.of()</code> は１つの引数でも同じ挙動をしてくれる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>Array.<span style=color:#66d9ef>of</span>() <span style=color:#75715e>// ==&gt; []
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>Array.<span style=color:#66d9ef>of</span>(<span style=color:#ae81ff>10</span>) <span style=color:#75715e>// ==&gt; [10]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>Array.<span style=color:#66d9ef>of</span>(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>) <span style=color:#75715e>// ==&gt; [1, 2, 3]
</span></span></span></code></pre></div><p>ESS6 以降では、<code>Array.from()</code> 関数を使って、引数の iterabole オブジェクトのコピー配列を作ることができる。<code>[..iterable]</code> に等しい。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>copy</span>  <span style=color:#f92672>=</span> Array.<span style=color:#a6e22e>from</span>(<span style=color:#a6e22e>original</span>);
</span></span></code></pre></div><h3 id=72-reading-and-writing-array-elements>7.2 Reading and Writing Array Elements</h3><p><code>[]</code> 演算子を使って配列の要素にアクセスできる。</p><p>配列はオブジェクトの一種にすぎない。数値のインデックス <code>1</code> は文字列 <code>"2"</code> に変換されて、プロパティ名として使われる。境界エラーはなく、配列の長さの範囲外にアクセスしても <code>undefined</code> が返されるだけ。</p><h3 id=73-sparse-arrays>7.3 Sparse Arrays</h3><p><em>疎な配列(sparse array)</em> は、要素が連続していないような配列。疎な配列は、要素の数より <code>length</code> プロパティの値が大きくなる。</p><h3 id=74-array-length>7.4 Array Length</h3><p>配列には <code>length</code> プロパティがあり、最大のインデックス + 1 という値になる。配列の <code>length</code> を現在の値より小さな値にセットすると、新しい <code>length</code> 値以上のインデックスの要素はすべて削除される。逆に配列の <code>lenghth</code> を現在の値より大きな値にセットすると、剰余な部分は疎な配列領域になる。</p><h3 id=75-adding-and-deleting-array-elements>7.5 Adding and Deleting Array Elements</h3><p>配列に要素を追加するためには、値を新しいインデックスにセットすればよい。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;zero&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;one&#34;</span>;
</span></span></code></pre></div><p><code>push()</code> メソッドを使っても、配列の終わりに要素を追加できる。<code>unshift()</code> メソッドで、配列の最初に要素を追加できる。<code>pop()</code> メソッドで、配列の最後の要素を削除できる。<code>shift()</code> メソッドで、配列の最初の要素を削除できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>push</span>(<span style=color:#e6db74>&#34;zero&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>push</span>(<span style=color:#e6db74>&#34;one&#34;</span>);
</span></span></code></pre></div><p>配列の要素を削除するためには、<code>delete</code> 演算子を使う。<code>delete</code> 演算子では <code>length</code> の値は変わらず、配列は疎になる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>delete</span> <span style=color:#a6e22e>a</span>[<span style=color:#ae81ff>2</span>]; <span style=color:#75715e>// a == [1, 2, &lt;1 empty item&gt;]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#ae81ff>2</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>a</span> <span style=color:#75715e>// ==&gt; false
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>length</span> <span style=color:#75715e>// ==&gt; 3
</span></span></span></code></pre></div><h3 id=76-iterating-arrays>7.6 Iterating Arrays</h3><p>ES6 からは、<code>for/of</code> ループを使って配列の要素を繰り返し処理することができる。<code>forEach()</code> メソッドを使ってもよい。</p><h3 id=77-multidimensional-arrays>7.7 Multidimensional Arrays</h3><p>JavaScript は多次元配列をサポートしていないが、配列の配列を使ってそれらしいことはできる。</p><h3 id=78-array-methods>7.8 Array Methods</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>5</span>], <span style=color:#a6e22e>sum</span> <span style=color:#f92672>=</span> ;
</span></span><span style=display:flex><span><span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>value</span> =&gt; { <span style=color:#a6e22e>sum</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>value</span>; });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>x</span> =&gt; <span style=color:#a6e22e>x</span><span style=color:#f92672>*</span><span style=color:#a6e22e>x</span>) <span style=color:#75715e>// =&gt; [1, 4, 9, 16, 25]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>filter</span>(<span style=color:#a6e22e>x</span> =&gt; <span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>3</span>) <span style=color:#75715e>// =&gt; [1, 2]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>findIndex</span>(<span style=color:#a6e22e>x</span> =&gt; <span style=color:#a6e22e>x</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>3</span>) <span style=color:#75715e>// =&gt; 2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>findIndex</span>(<span style=color:#a6e22e>x</span> =&gt; <span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) <span style=color:#75715e>// =&gt; -1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>find</span>(<span style=color:#a6e22e>x</span> =&gt; <span style=color:#a6e22e>x</span> <span style=color:#f92672>%</span> <span style=color:#ae81ff>5</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) <span style=color:#75715e>// =&gt; 5
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>find</span>(<span style=color:#a6e22e>x</span> =&gt; <span style=color:#a6e22e>x</span> <span style=color:#f92672>%</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) <span style=color:#75715e>// =&gt; undefined
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>every</span>(<span style=color:#a6e22e>x</span> =&gt; <span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>10</span>) <span style=color:#75715e>// =&gt; true
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>every</span>(<span style=color:#a6e22e>x</span> =&gt; <span style=color:#a6e22e>x</span> <span style=color:#f92672>%</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) <span style=color:#75715e>// =&gt; false
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>some</span>(<span style=color:#a6e22e>x</span> =&gt; <span style=color:#a6e22e>x</span> <span style=color:#f92672>%</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) <span style=color:#75715e>// =&gt; true
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>some</span>(isNaN) <span style=color:#75715e>// =&gt; false
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>reduce</span>((<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) =&gt; <span style=color:#a6e22e>x</span><span style=color:#f92672>+</span><span style=color:#a6e22e>y</span>, <span style=color:#ae81ff>0</span>)<span style=color:#75715e>// =&gt; 15
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>[<span style=color:#ae81ff>1</span>, [<span style=color:#ae81ff>2</span>, [<span style=color:#ae81ff>3</span>]]].<span style=color:#a6e22e>flat</span>() <span style=color:#75715e>// =&gt; [1, 2, [3]]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>[<span style=color:#ae81ff>1</span>, [<span style=color:#ae81ff>2</span>, [<span style=color:#ae81ff>3</span>]]].<span style=color:#a6e22e>flat</span>(<span style=color:#ae81ff>2</span>) <span style=color:#75715e>// =&gt; [1, 2, 3]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>concat</span>(<span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>7</span>) <span style=color:#75715e>// =&gt; [1, 2, 3, 4, 5, 6, 7]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>3</span>) <span style=color:#75715e>// =&gt; [1, 2, 3]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>splice</span>(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>) <span style=color:#75715e>// =&gt; [2, 3]; a == [1, 4, 5]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>splice</span>(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>0</span>, <span style=color:#e6db74>&#34;a&#34;</span>, <span style=color:#e6db74>&#34;b&#34;</span>) <span style=color:#75715e>// =&gt; []; a == [1, 2, &#34;a&#34;, &#34;b&#34;, 3, 4, 5]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>indexOf</span>(<span style=color:#ae81ff>2</span>) <span style=color:#75715e>// =&gt; 1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>lastIndexOf</span>(<span style=color:#ae81ff>2</span>) <span style=color:#75715e>// =&gt; 1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#ae81ff>2</span>) <span style=color:#75715e>// =&gt; true
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>sort</span>(); <span style=color:#75715e>// a == [1, 2, 3, 4, 5]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>reverse</span>(); <span style=color:#75715e>// a == [5, 4, 3, 2, 1]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>join</span>() <span style=color:#75715e>// =&gt; &#34;1,2,3,4,5&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#34; &#34;</span>) <span style=color:#75715e>// =&gt; &#34;1 2 3 4 5&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>Array.<span style=color:#a6e22e>isArray</span>([]) <span style=color:#75715e>// =&gt; true
</span></span></span></code></pre></div><h3 id=79-array-like-objects>7.9 Array-Like Objects</h3><h3 id=710-strings-as-arrays>7.10 Strings as Arrays</h3><p>JavaScript 文字列は、UTF-16 Unicode 文字の読み込み専用配列のようにふるまう。</p><h2 id=8-functions>8. Functions</h2><h3 id=81-defining-functions>8.1 Defining Functions</h3><p>関数宣言は、<code>function name(param1, param2, ...) { ... }</code> という構文になる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>distance</span>(<span style=color:#a6e22e>x1</span>, <span style=color:#a6e22e>y1</span>, <span style=color:#a6e22e>x2</span>, <span style=color:#a6e22e>y2</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>dx</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>x2</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>x1</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>dy</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>y2</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>y1</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> Math.<span style=color:#a6e22e>sqrt</span>(<span style=color:#a6e22e>dx</span><span style=color:#f92672>*</span><span style=color:#a6e22e>dx</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>dy</span><span style=color:#f92672>*</span><span style=color:#a6e22e>dy</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>関数式は、関数宣言に近いが、式として現れ、関数名は省略できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>square</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>x</span>) { <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>x</span><span style=color:#f92672>*</span><span style=color:#a6e22e>x</span>; }
</span></span></code></pre></div><p>ES6 以降では、アロー関数というコンパクトな構文の関数式がある：<code>(param1, param2, ...) => { ... }</code>。ボディが <code>return</code> 文１つだけの場合、波カッコと <code>return</code> を省略することができる。また、引数が１つだけの場合、丸カッコを省略することができる。<code>function</code> キーワードによる関数定義と違ってアロー関数は、関数が定義されているコンテクストの <code>this</code> の値を継承する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sum</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) =&gt; { <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>y</span>; };
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>add1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>x</span> =&gt; <span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
</span></span></code></pre></div><h3 id=82-invoking-functions>8.2 Invoking Functions</h3><p>関数呼び出しは、<code>func(arg1, arg2, ...)</code> という構文になる。non-strict モードでは、<code>this</code> の値はグローバルオブジェクトになる。strict モードでは、<code>this</code> の値は <code>undefined</code> になる。ただしアロー関数の場合、<code>this</code> の値はいずれにしても定義された箇所の <code>this</code> になる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>d</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>distance</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>1</span>);
</span></span></code></pre></div><p>メソッド呼び出しは、<code>obj.method(arg1, arg2, ...)</code> という構文になる。<code>obj</code> オブジェクトの <code>method</code> プロパティが返す関数が呼び出され、<code>this</code> の値は <code>obj</code> になる。ネストした関数では、いったん別の変数にセットしておかないと親の <code>this</code> にアクセスすることができない。アロー関数ならこの問題を解決できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>rect</span>.<span style=color:#a6e22e>setSize</span>(<span style=color:#a6e22e>width</span>, <span style=color:#a6e22e>height</span>);
</span></span></code></pre></div><p>コンストラクタ呼び出しは、関数呼び出しまたはメソッド呼び出しの前に <code>new</code> キーワードを付ける。引数がない場合、丸カッコは省略できる。コンストラクタ呼び出しは、コンストラクタの <code>prototype</code> プロパティを継承した新しい空オブジェクトを生成して、<code>this</code> にバインドして、コンストラクタ関数を呼び出す。コンストラクタ関数が特に値を返さないか、プリミティブ値を返した場合、<code>this</code> の値が返される。</p><p><code>call()</code> または <code>apply()</code> メソッドを使っても、間接的に関数を呼び出せる。8.7 節参照。</p><p>ほかにも、暗黙の関数呼び出しがある。ゲッター、セッターのメソッド呼び出し。文字列コンテクストにおける非文字列オブジェクトに対する <code>toString()</code> メソッドの呼び出し。iterable オブジェクトの反復処理におけるメソッド呼び出し。タグテンプレートリテラルにおける関数呼び出し。プロキシオブジェクト。</p><h3 id=83-function-arguments-and-parameters>8.3 Function Arguments and Parameters</h3><p>JavaScript 関数の呼び出しは、渡される引数の型も数もチェックしない。</p><p>関数が宣言したパラメータより少ない引数で呼び出されたとき、残りのパラメータはデフォルト値 <code>undefined</code> がセットされる。</p><p>ES6 以降では、関数のパラメータにデフォルト値を定義できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getPropertyNames</span>(<span style=color:#a6e22e>o</span>, <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> []) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>property</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>o</span>) <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>property</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>a</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ES6 以降では、<strong>残余パラメータ</strong> で、任意の数の引数で呼び出すことができる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>first</span><span style=color:#f92672>=-</span><span style=color:#66d9ef>Infinity</span>, ...<span style=color:#a6e22e>rest</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>maxValue</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>first</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>n</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>rest</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>n</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>maxValue</span>) <span style=color:#a6e22e>maxValue</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>n</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>maxValue</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ES6 以前は残余パラメータがないため、Arguments オブジェクトを使って可変引数関数を書く。<code>arguments</code> という変数名で配列風の Arguments オブジェクトに参照できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>x</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>maxValue</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#66d9ef>Infinity</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>arguments</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>arguments</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>maxValue</span>) <span style=color:#a6e22e>maxValue</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>arguments</span>[<span style=color:#a6e22e>i</span>];
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>maxValue</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>スプレッド演算子 <code>...</code> を使って、配列の要素を展開することができる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>numbers</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>10</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>9</span>, <span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>Math.<span style=color:#a6e22e>min</span>(...<span style=color:#a6e22e>numbers</span>);
</span></span></code></pre></div><p>関数定義のパラメータリスト内を配列リテラルやオブジェクトリテラルで書くと、引数をその構造に分割代入する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>vectorAdd</span>([<span style=color:#a6e22e>x1</span>, <span style=color:#a6e22e>y1</span>], [<span style=color:#a6e22e>x2</span>, <span style=color:#a6e22e>y2</span>]) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> [<span style=color:#a6e22e>x1</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>x2</span>, <span style=color:#a6e22e>y1</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>y2</span>];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>vectorMultiply</span>({<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>}, <span style=color:#a6e22e>scalar</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> { <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>scalar</span>, <span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>scalar</span>};
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=84-functions-as-values>8.4 Functions as Values</h3><p>JavaScript では、関数はただの構文ではなく値でもあり、変数に代入したり、オブジェクトのプロパティや配列の要素にセットしたり、関数の引数に渡したりできる。</p><p>JavaScript の関数はプリミティブ値ではなくオブジェクトの一種なので、プロパティを持つことができる。関数が &ldquo;static&rdquo; 変数を必要とする場合、関数のプロパティを使うと便利。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>uniqueIneger</span>.<span style=color:#a6e22e>counter</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>uniqueInteger</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>uniqueInteger</span>.<span style=color:#a6e22e>counter</span><span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>関数内で宣言した変数は関数外からは見えない。一時的な名前空間として関数を定義することもできる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>(<span style=color:#66d9ef>function</span>() {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ttemporary namespace
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}());
</span></span></code></pre></div><h3 id=86-クロージャ>8.6 クロージャ</h3><p>JavaScript は <em>レキシカルスコープ(lexical scope)</em> を使っている。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>counter</span>(<span style=color:#a6e22e>n</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>get</span> <span style=color:#a6e22e>count</span>() { <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>n</span><span style=color:#f92672>++</span>; }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>set</span> <span style=color:#a6e22e>count</span>(<span style=color:#a6e22e>m</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>m</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>n</span>) <span style=color:#a6e22e>n</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>m</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>throw</span> Error(<span style=color:#e6db74>&#34;count can only be set to a larger value&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=87-function-properties-methods-and-constructor>8.7 Function Properties, Methods, and Constructor</h3><p>関数の <code>length</code> プロパティは読み込み専用で、関数の引数の数 <em>アリティ(arity)</em> を返す。</p><p>関数の <code>name</code> プロパティは読み込み専用で、関数を定義したときの名前を返す。</p><p>アロー関数以外の関数はすべて、<code>prototype</code> プロパティを持つ。</p><p>関数の <code>call()</code> と <code>apply()</code> メソッドは、その関数を呼ぶ。<code>call()</code> メソッドの第１引数は呼び出し関数の <code>this</code> になり、第２引数以降はそのまま呼び出し関数の第１引数以降になる。<code>apply()</code> メソッドの第１引数は呼び出し関数の <code>this</code> になり、第２引数は呼び出し関数の引数群の配列になる。</p><p>関数 <code>f</code> に対してオブジェクト <code>o</code> を渡して <code>bind()</code> メソッドを呼ぶと、<code>o</code> のメソッドとして束縛された関数 <code>f</code> を返す。</p><p><code>Function()</code> コンストラクタは新しい関数を返す。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>f</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Function(<span style=color:#e6db74>&#34;x&#34;</span>, <span style=color:#e6db74>&#34;y&#34;</span>, <span style=color:#e6db74>&#34;return x*y;&#34;</span>);
</span></span></code></pre></div><h3 id=88-functional-programming>8.8 Functional Programming</h3><p>配列メソッド <code>map()</code> や <code>reduce()</code> を使って、引数に関数を渡して配列処理ができる。</p><p><em>高階関数(higher-order function)</em> は、関数を引数にとって新しい関数を返すような関数。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>not</span>(<span style=color:#a6e22e>f</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>function</span>(...<span style=color:#a6e22e>args</span>) { <span style=color:#66d9ef>return</span> <span style=color:#f92672>!</span>(<span style=color:#a6e22e>f</span>.<span style=color:#a6e22e>apply</span>(<span style=color:#66d9ef>this</span>, <span style=color:#a6e22e>args</span>)); }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=9-classes>9. Classes</h2><h3 id=91-classes-and-prototypes>9.1 Classes and Prototypes</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// factory function
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>range</span>(<span style=color:#a6e22e>from</span>, <span style=color:#a6e22e>to</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>r</span> <span style=color:#f92672>=</span> Object.<span style=color:#a6e22e>create</span>(<span style=color:#a6e22e>range</span>.<span style=color:#a6e22e>methods</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>from</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>from</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>to</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>to</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>range</span>.<span style=color:#a6e22e>methods</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>includes</span>(<span style=color:#a6e22e>x</span>) { <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>from</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>to</span>; },
</span></span><span style=display:flex><span>  <span style=color:#f92672>*</span>[<span style=color:#a6e22e>Symbol</span>.<span style=color:#a6e22e>iterator</span>]() { <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>ceil</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>from</span>); <span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>to</span>; <span style=color:#a6e22e>x</span><span style=color:#f92672>++</span>) <span style=color:#66d9ef>yield</span> <span style=color:#a6e22e>x</span>; },
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>toString</span>() { <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;(&#34;</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>from</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;...&#34;</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>to</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;)&#34;</span>; }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>r</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>range</span>(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#ae81ff>2</span>) <span style=color:#75715e>// =&gt; true
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>toString</span>() <span style=color:#75715e>// =&gt; &#34;(1...3)&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>[...<span style=color:#a6e22e>r</span>] <span style=color:#75715e>// =&gt; [1, 2, 3]
</span></span></span></code></pre></div><h3 id=92-classes-and-constructors>9.2 Classes and Constructors</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// constructor
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>Range</span>(<span style=color:#a6e22e>from</span>, <span style=color:#a6e22e>to</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>from</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>from</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>to</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>to</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Range</span>.<span style=color:#a6e22e>prototype</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>includes</span>(<span style=color:#a6e22e>x</span>) { <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>from</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>to</span>; },
</span></span><span style=display:flex><span>  <span style=color:#f92672>*</span>[<span style=color:#a6e22e>Symbol</span>.<span style=color:#a6e22e>iterator</span>]() { <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>ceil</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>from</span>); <span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>to</span>; <span style=color:#a6e22e>x</span><span style=color:#f92672>++</span>) <span style=color:#66d9ef>yield</span> <span style=color:#a6e22e>x</span>; },
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>toString</span>() { <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;(&#34;</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>from</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;...&#34;</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>to</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;)&#34;</span>; }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>r</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Range</span>(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>r</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>Range</span> <span style=color:#75715e>// =&gt; true
</span></span></span></code></pre></div><h3 id=93-classes-with-the-class-keyword>9.3 Classes with the class Keyword</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Range</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>from</span>, <span style=color:#a6e22e>to</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>from</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>from</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>to</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>to</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>static</span> <span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>s</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>matches</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>match</span>(<span style=color:#e6db74>/^\((\d+)\.\.\.(\d+)\)$/</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>matches</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>TypeError</span>(<span style=color:#e6db74>`Cannot parse Range from &#34;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>s</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;.`</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Range</span>(parseInt(<span style=color:#a6e22e>matches</span>[<span style=color:#ae81ff>1</span>]), parseInt(<span style=color:#a6e22e>matches</span>[<span style=color:#ae81ff>2</span>]));
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>includes</span>(<span style=color:#a6e22e>x</span>) { <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>from</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>to</span>; }
</span></span><span style=display:flex><span>  <span style=color:#f92672>*</span>[<span style=color:#a6e22e>Symbol</span>.<span style=color:#a6e22e>iterator</span>]() { <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>ceil</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>from</span>); <span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>to</span>; <span style=color:#a6e22e>x</span><span style=color:#f92672>++</span>) <span style=color:#66d9ef>yield</span> <span style=color:#a6e22e>x</span>; }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>toString</span>() { <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;(&#34;</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>from</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;...&#34;</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>to</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;)&#34;</span>; }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SSpan</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Range</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>start</span>, <span style=color:#a6e22e>length</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>length</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>start</span>, <span style=color:#a6e22e>start</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>length</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>start</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>length</span>, <span style=color:#a6e22e>start</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><code>class</code> 宣言内のコードはすべて暗黙で strict モードになる。</li><li>関数宣言と違って、クラス宣言はホイストされない。宣言前にインスタンス化することはできない。</li></ul><h3 id=94-adding-methods-to-existing-classes>9.4 Adding Methods to Existing Classes</h3><p>新しいメソッドをプロトタイプオブジェクトに追加することで、既存クラスへのメソッド追加ができる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>String.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>startsWith</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>s</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>indexOf</span>(<span style=color:#a6e22e>s</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=95-subclasses>9.5 Subclasses</h3><p><code>class/extends</code> 記法以前でのサブクラスの作り方：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>Function <span style=color:#a6e22e>Span</span>(<span style=color:#a6e22e>start</span>, <span style=color:#a6e22e>length</span>) { ... }
</span></span><span style=display:flex><span><span style=color:#a6e22e>Span</span>.<span style=color:#a6e22e>prototype</span> <span style=color:#f92672>=</span> Object.<span style=color:#a6e22e>create</span>(<span style=color:#a6e22e>Range</span>.<span style=color:#a6e22e>prototype</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>Span</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>constructor</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Span</span>;
</span></span></code></pre></div><ul><li><code>extends</code> キーワードでクラスを定義する場合、スーパークラスのコンストラクタを呼ぶために <code>super()</code> を呼ばないといけない。</li><li>サブクラスでコンストラクタを定義しなかったら、自動で <code>super()</code> を呼ぶコンストラクタが定義される。</li><li><code>super()</code> を呼ぶまでは <code>this</code> キーワードは使わない方がよい。</li><li><code>new</code> キーワードなしで呼ばれた関数では <code>new.keyword</code> が undefined になる。コンストラクタ関数では <code>new.target</code> はコンストラクタへの参照になる。</li></ul><h2 id=10-modules>10. Modules</h2><h3 id=101-modules-with-classes-objects-and-closures>10.1 Modules with Classes, Objects, and Closures</h3><p>旧来の JavaScript の機能の範囲でもモジュールのようなものは表現できる：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>modules</span> <span style=color:#f92672>=</span> {};
</span></span><span style=display:flex><span><span style=color:#a6e22e>funtion</span> <span style=color:#a6e22e>require</span>(<span style=color:#a6e22e>moduleName</span>) { <span style=color:#a6e22e>retuern</span> <span style=color:#a6e22e>modules</span>[<span style=color:#a6e22e>moduleName</span>]; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>modules</span>[<span style=color:#e6db74>&#34;stats.js&#34;</span>] <span style=color:#f92672>=</span> (<span style=color:#66d9ef>function</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// The contents of the stats.js file go here:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sum</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) =&gt; <span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>y</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>square</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>x</span> =&gt; <span style=color:#a6e22e>x</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>mean</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>data</span>) { <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>reduce</span>(<span style=color:#a6e22e>sum</span>) <span style=color:#f92672>/</span> <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>length</span>; };
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>stddev</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>data</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>m</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>mean</span>(<span style=color:#a6e22e>data</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> Math.<span style=color:#a6e22e>sqrt</span>(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>x</span> =&gt; <span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>m</span>).<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>square</span>).<span style=color:#a6e22e>reduce</span>(<span style=color:#a6e22e>sum</span>) <span style=color:#f92672>/</span> (<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>length</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>));
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>exports</span>;
</span></span><span style=display:flex><span>}());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>stats</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span> (<span style=color:#e6db74>&#34;stats.js&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>stats</span>.<span style=color:#a6e22e>mean</span>([<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>9</span>]) <span style=color:#75715e>// =&gt; 5
</span></span></span></code></pre></div><p>複数のファイルを１つのファイルにまとめあげる webpack や Parcel のようなコードバンドルツールによって、実質上のようなコードが生成される。</p><h3 id=102-modules-in-node>10.2 Modules in Node</h3><p>NOde はグローバルな <code>exports</code> オブジェクトを定義している。Node モジュールを定義するときにはこの <code>exports</code> にエクスポートしたいプロパティをセットする。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>mean</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>data</span>) { <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>reduce</span>(<span style=color:#a6e22e>sum</span>) <span style=color:#f92672>/</span> <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>length</span>; };
</span></span></code></pre></div><p>ただし、１つのモジュールで１つの関数やクラスしかエクスポートしないときには、代わりに <code>module.exports</code> にエクスポートしたい１つの値をセットする。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BitSet</span> { ... };
</span></span></code></pre></div><p>Node でモジュールをインポートするときには <code>require()</code> 関数を呼ぶ。その引数はインポートしたいモジュール名で、エクスポートされた値が返される。</p><p>Node ビルトインのモジュールやパッケージマネージャでインストールずみのおmジュールをインポートしたければ、モジュール名をそのまま指定すればよい。自分のコードのモジュールをインポートしたければ、そのモジュールのファイルパスを指定する。</p><p>モジュールが１つの関数かクラスをエクスポートしているだけなら、<code>require</code> すればその値が返ってくる。モジュールが複数のプロパティを持つオブジェクトであれば、オブジェクト全体をインポートしてもいいし、その中で特定のプロパティだけインポートしてもいい。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;js&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>stats</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./stats.js&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>stddev</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./stats.js&#39;</span>);
</span></span></code></pre></div><h3 id=103-modules-in-es6>10.3 Modules in ES6</h3><p>ES6 では <code>import</code> と <code>export</code> キーワードが追加されて、モジュールシステムをサポートするようになった。</p><p>定数・変数・関数・クラスをエクスポートしたければ、宣言の前に <code>export</code> を付ける。あるいは、エクスポートしたい値をまとめて <code>export { ... }</code> の中で設定する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// A
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>PI</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>PI</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Circle</span> { ... }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// B
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>PI</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>PI</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Circle</span> { ... }
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> { <span style=color:#a6e22e>Circle</span>, <span style=color:#a6e22e>PI</span> };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// C
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BitSet</span> { ... }
</span></span></code></pre></div><p>また、宣言の前に <code>export default</code> を付ければ、単一の値をそのままエクスポートできる。</p><p>モジュールをインポートしたければ、<code>import</code> キーワードを使う。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// A
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>mean</span>, <span style=color:#a6e22e>stddev</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./stats.js&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// B
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>as</span> <span style=color:#a6e22e>stats</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./stats.js&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// C
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>BitSet</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./bitset.js&#39;</span>
</span></span></code></pre></div><p><code>as</code> キーワードを使えばリネームもできる：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>render</span> <span style=color:#a6e22e>as</span> <span style=color:#a6e22e>renderImage</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./imageutils.js&#34;</span>;
</span></span></code></pre></div><p>ES2020 からは、<code>import()</code> 関数を使ったダイナミックインポートもできる：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>import</span>(<span style=color:#e6db74>&#34;./stats.js&#34;</span>).<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>stats</span> =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>average</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>stats</span>.<span style=color:#a6e22e>mean</span>(<span style=color:#a6e22e>data</span>);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h2 id=11-the-javascript-standard-library>11. The JavaScript Standard Library</h2><h3 id=111-sets-and-maps>11.1 Sets and Maps</h3><p>オブジェクトはマップとして使えるが、文字列に限定されていたり、元々あるプロパティ <code>toString</code> があることによる複雑性があったりする。そのため、ES6 では真の <code>Set</code> と <code>Map</code> クラスが導入された。</p><p><code>Set</code> は値の集合だが、配列と違って順序がなく、重複も許されない。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>s</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Set</span>();
</span></span><span style=display:flex><span><span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>add</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>s</span>.<span style=color:#66d9ef>delete</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>has</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>clear</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>size</span>
</span></span></code></pre></div><p><code>Map</code> はキーバリューの集合である。配列のようだが、配列と違って、整数でなく任意の値をインデックスとして使える。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>m</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Map</span>();
</span></span><span style=display:flex><span><span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#34;one&#34;</span>, <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>m</span>.<span style=color:#66d9ef>delete</span>(<span style=color:#e6db74>&#34;one&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;one&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>has</span>(<span style=color:#e6db74>&#34;one&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>clear</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>size</span>
</span></span></code></pre></div><p><code>WeakMap</code> は、キーバリューが GC されうるような Map の変種である。キャッシュなどに用いられる。<code>WeakSet</code> も値が GC されうるような Set の変種である。</p><h3 id=112-typed-arrays-and-binary-data>11.2 Typed Arrays and Binary Data</h3><p>ES6 で <em>型付き配列(Typed arrays)</em> が導入された。型付き配列は、要素の型と配列長が限定された配列で、要素は 0 で初期化されている。</p><ul><li><code>Int8Array</code>: 符号付きバイト</li><li><code>Uint8Array</code>: 符号なしバイト</li><li><code>Uint8ClampedArray</code>: 符号なしバイト（-1以上は0に、256以上は255に丸められる）</li><li><code>Int16Array</code>: 符号付き16ビット整数</li><li><code>Uint16Array</code>: 符号なし16ビット整数</li><li><code>Int32Array</code>: 符号付き32ビット整数</li><li><code>Uint32Array</code>: 符号なし32ビット整数</li><li><code>BigInt64Array</code>: 符号付き64ビット BigInt (ES2020)</li><li><code>BigUint64Array</code>: 符号なし64ビット BigInt (ES2020)</li><li><code>Float32Array</code>: 32ビット浮動小数点数</li><li><code>Float64Array</code>: 64ビット浮動小数点数（通常の JavaScript 数値の型）</li></ul><p>型付き配列の作り方はいくつかある。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// 要素数を引数にしてコンストラクタを呼ぶ。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>bytes</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Uint8Array</span>(<span style=color:#ae81ff>1024</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 要素群を引数にして of ファクトリメソッドを呼ぶ。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>white</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Uint8ClampedArray</span>.<span style=color:#66d9ef>of</span>(<span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 要素の配列を引数にして from ファクトリメソッドを呼ぶ。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>ints</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Uint32Array</span>.<span style=color:#a6e22e>from</span>(<span style=color:#a6e22e>white</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ArrayBuffer を引数にしてコンストラクタを呼ぶ。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>buffer</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ArrayBuffer</span>(<span style=color:#ae81ff>1024</span><span style=color:#f92672>*</span><span style=color:#ae81ff>1024</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>asbytes</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Uint8Array</span>(<span style=color:#a6e22e>buffer</span>[, <span style=color:#a6e22e>offset</span>[, <span style=color:#a6e22e>length</span>]]);
</span></span></code></pre></div><p>型付き配列は <code>buffer</code> プロパティを持ち、対応する <code>ArrayBuffer</code> を返す。</p><p>型付き配列は、ネイティブのエンディアンを使う。リトルエンディアンのシステムでは、最下位から最上位の順にバイトが並ぶ。ビッグエンディアンのシステムでは、最上位から最下位の順にバイトが並ぶ。</p><p><code>DataView</code> クラスを使えば、特定のバイト順で値を読み書きできる。ZIP ファイルを展開したり、JPEG ファイルからメタデータを抽出したりするのに使う。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>view</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DataView</span>(<span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>buffer</span>, <span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>byteOffset</span>, <span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>byteLength</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>view</span>.<span style=color:#a6e22e>getInt32</span>(<span style=color:#ae81ff>0</span>) <span style=color:#75715e>// ビッグエンディアンで整数を取得する
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>view</span>.<span style=color:#a6e22e>getInt32</span>(<span style=color:#ae81ff>4</span>, <span style=color:#66d9ef>false</span>) <span style=color:#75715e>// ビッグエンディアンで整数を取得する
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>view</span>.<span style=color:#a6e22e>getUint32</span>(<span style=color:#ae81ff>8</span>, <span style=color:#66d9ef>true</span>); <span style=color:#75715e>// リトルエンディアンで整数を取得する
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>view</span>.<span style=color:#a6e22e>setUint32</span>(<span style=color:#ae81ff>8</span>, <span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>false</span>); <span style=color:#75715e>// ビッグエンディアンで整数を書き込む
</span></span></span></code></pre></div><h3 id=113-pattern-matching-with-regular-expressions>11.3 Pattern Matching with Regular Expressions</h3><p><em>正規表現 (regular expression)</em> はテキストのパターンを表現するオブジェクトである。</p><p>正規表現リテラルはスラッシュ文字で正規表現を囲む。末尾にフラグを付けられる。<code>RegExp()</code> コンストラクタを使って正規表現文字列を引数にしても、作成できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>pattern</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>/s$/</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>pattern</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>/s$/i</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>pattern</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> RegExp(<span style=color:#e6db74>&#34;s$&#34;</span>);
</span></span></code></pre></div><table><thead><tr><th>Character</th><th>Matches</th></tr></thead><tbody><tr><td><code>[...]</code></td><td>カッコ内の任意の１文字</td></tr><tr><td><code>[^...]</code></td><td>カッコ内以外のの任意の１文字</td></tr><tr><td><code>.</code></td><td>開業を除く任意の１文字</td></tr><tr><td><code>\w</code></td><td>任意の ASCII 単語文字 (<code>[a-zA-Z0-9_]</code>)</td></tr><tr><td><code>\W</code></td><td>任意の ASCII 単語以外の文字 (<code>[^a-zA-Z0-9_]</code>)</td></tr><tr><td><code>\s</code></td><td>任意の Unicode 空白文字</td></tr><tr><td><code>\S</code></td><td>任意の Unicode 空白以外の文字</td></tr><tr><td><code>\d</code></td><td>任意の ASCII 数字 (<code>[0-9]</code>)</td></tr><tr><td><code>\D</code></td><td>任意の ASCII 数字以外の文字 (<code>[^0-9]</code>)</td></tr><tr><td><code>{n,m}</code></td><td>直前アイテムのn回以上m回以下の繰り返し</td></tr><tr><td><code>{n,}</code></td><td>直前アイテムのn回以上の繰り返し</td></tr><tr><td><code>{n}</code></td><td>直前アイテムのn回の繰り返し</td></tr><tr><td><code>?</code></td><td>直前アイテムの0回または1回の繰り返し (<code>{0,1}</code>)</td></tr><tr><td><code>+</code></td><td>直前アイテムの1回以上の繰り返し (<code>{1,}</code>)</td></tr><tr><td><code>*</code></td><td>直前アイテムの0回以上の繰り返し (<code>{0,}</code>)</td></tr><tr><td>`</td><td>`</td></tr><tr><td><code>(...)</code></td><td>グルーピングして１つのアイテムにする。後方参照にも利用する</td></tr><tr><td><code>(?:...)</code></td><td>グルーピングして１つのアイテムにする。後方参照にはならない</td></tr><tr><td><code>\N</code></td><td>後方参照</td></tr><tr><td><code>^</code></td><td>文字列の最初、または <code>m</code> フラグを付けると行頭</td></tr><tr><td><code>$</code></td><td>文字列の終わり、または <code>m</code> フラグを付けると行末</td></tr><tr><td><code>\b</code></td><td>単語境界</td></tr><tr><td><code>\B</code></td><td>単語境界でない位置</td></tr><tr><td><code>(?=p)</code></td><td>先読み</td></tr><tr><td><code>(?!p)</code></td><td>否定先読み</td></tr><tr><td><code>(?&lt;=p)</code></td><td>後読み (ES2018)</td></tr><tr><td><code>(?&lt;!p)</code></td><td>否定後読み (ES2018)</td></tr></tbody></table><p>繰り返しは greedy にマッチする。つまり、可能な限りたくさんマッチする。逆に可能な限り少なくマッチさせたければ <code>?</code> を付与する。</p><table><thead><tr><th>Flag</th><th>Description</th></tr></thead><tbody><tr><td><code>g</code></td><td>最初のマッチだけでなくすべてマッチする</td></tr><tr><td><code>i</code></td><td>大文字小文字を区別しない</td></tr><tr><td><code>m</code></td><td>複数行モード</td></tr><tr><td><code>s</code></td><td><code>.</code> が改行も含んでマッチする (ES2018)</td></tr><tr><td><code>u</code></td><td>Unicode コードポイントでマッチする (ES2018)</td></tr><tr><td><code>y</code></td><td>sticky</td></tr></tbody></table><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#e6db74>&#34;JavaScript&#34;</span>.<span style=color:#a6e22e>search</span>(<span style=color:#e6db74>/script/ui</span>) <span style=color:#75715e>// =&gt; 4
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>text</span>.<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>/javascritp/gi</span>, <span style=color:#e6db74>&#34;JavaScript&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;7 plus 8 equals 15&#34;</span>.<span style=color:#a6e22e>match</span>(<span style=color:#e6db74>/\d+/g</span>) <span style=color:#75715e>// =&gt; [&#34;7&#34;, &#34;8&#34;, &#34;15&#34;]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#e6db74>&#34;Visit my blog at http://www.example.com/~david&#34;</span>.<span style=color:#a6e22e>match</span>(<span style=color:#e6db74>/(?&lt;protocol&gt;\w+):\/\/(?&lt;host&gt;[\w.]+)\/(?&lt;path&gt;\S*)/</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// =&gt; [&#39;http://www.example.com/~david&#39;, &#39;http&#39;, &#39;www.example.com&#39;, &#39;~david&#39;, index: 17, input: &#39;Visit my blog at http://www.example.com/~david&#39;, groups: { protocol: &#39;http&#39;, host: &#39;www.example.com&#39;, path: &#39;~david&#39; }]
</span></span></span></code></pre></div><p>Note: &ldquo;JavaScript Standard Library&rdquo; という章に正規表現が扱われている理由はぴんと来ない。正規表現リテラルがある以上、文字列と同じ次元の扱いのようにも思える。</p><h3 id=114-dates-and-times>11.4 Dates and Times</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>now</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date(); <span style=color:#75715e>// current time
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>epoch</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date(<span style=color:#ae81ff>0</span>); <span style=color:#75715e>// 1970/01/01 00:00:00
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>century</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date(<span style=color:#ae81ff>2100</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>5</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>now</span>.<span style=color:#a6e22e>toString</span>() <span style=color:#75715e>// =&gt; &#39;Sun Nov 22 2020 01:36:12 GMT+0900 (Japan Standard Time)&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>now</span>.<span style=color:#a6e22e>toLocaleString</span>() <span style=color:#75715e>// =&gt; &#39;11/22/2020, 1:36:12 AM&#39;
</span></span></span></code></pre></div><h3 id=115-error-class>11.5 Error Class</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HTTPError</span> <span style=color:#66d9ef>extends</span> Error {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>status</span>, <span style=color:#a6e22e>statusText</span>, <span style=color:#a6e22e>url</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(<span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>status</span><span style=color:#e6db74>}</span><span style=color:#e6db74> </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>statusText</span><span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>url</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>status</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>statueText</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>statusText</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>url</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>get</span> <span style=color:#a6e22e>name</span>() { <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;HTTPError&#34;</span> }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=116-json-serialization-and-parsing>11.6 JSON Serialization and Parsing</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>o</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>s</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>n</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> [<span style=color:#66d9ef>true</span>, <span style=color:#66d9ef>false</span>, <span style=color:#66d9ef>null</span>] };
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>s</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>o</span>); <span style=color:#75715e>// s == &#39;{&#34;s&#34;:&#34;&#34;,&#34;n&#34;:0,&#34;a&#34;:[true,false,null]}&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>copy</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>s</span>); <span style=color:#75715e>// copy == o
</span></span></span></code></pre></div><h3 id=117-the-internationalization-api>11.7 The Internationalization API</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>Intl</span>.<span style=color:#a6e22e>NumberFormat</span>(<span style=color:#e6db74>&#39;ja-JP&#39;</span>, { <span style=color:#a6e22e>style</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;currency&#39;</span>, <span style=color:#a6e22e>currency</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;JPY&#39;</span> }).<span style=color:#a6e22e>format</span>(<span style=color:#e6db74>&#34;123456&#34;</span>) <span style=color:#75715e>// =&gt; &#39;￥123,456&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>Intl</span>.<span style=color:#a6e22e>DateTimeFormat</span>(<span style=color:#e6db74>&#34;ja-JP&#34;</span>, { <span style=color:#a6e22e>era</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;short&#34;</span> }).<span style=color:#a6e22e>format</span>(<span style=color:#a6e22e>now</span>) <span style=color:#75715e>// =&gt; &#39;西暦2020年11月22日&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>[<span style=color:#e6db74>&#34;page10&#34;</span>, <span style=color:#e6db74>&#34;page9&#34;</span>].<span style=color:#a6e22e>sort</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Intl</span>.<span style=color:#a6e22e>Collator</span>(<span style=color:#66d9ef>undefined</span>, { <span style=color:#a6e22e>numeric</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span> }).<span style=color:#a6e22e>compare</span>) <span style=color:#75715e>// =&gt; [ &#39;page9&#39;, &#39;page10&#39; ]
</span></span></span></code></pre></div><h3 id=118-the-console-api>11.8 The Console API</h3><ul><li><p><code>console.log()</code>: コンソールに出力する。</p></li><li><p><code>console.debug()</code>, <code>console.info()</code>, <code>console.warn()</code>, <code>console.error()</code>: ほぼ <code>console.log()</code> と同じ。</p></li><li><p><code>console.assert()</code>: 第１引数が真なら、何もしない。第１引数が偽なら、<code>console.error()</code> で出力する。</p></li><li><p><code>%s</code>: 引数を文字列に変換する。</p></li><li><p><code>%i</code>, <code>%d</code>: 引数を整数に変換する。</p></li><li><p><code>%f</code>: 引数を数字に変換する。</p></li><li><p><code>%o</code>, <code>%O</code>: 引数をオブジェクトとしてプロパティを表示する。</p></li><li><p><code>%c</code>: 引数は CSS スタイルの文字列として扱われる。</p></li></ul><h3 id=119-url-apis>11.9 URL APIs</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>URL</span>(<span style=color:#e6db74>&#34;https://example.com:8000/path/name?q=term#fragment&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>href</span> <span style=color:#75715e>// =&gt; &#39;https://example.com:8000/path/name?q=term#fragment&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>origin</span> <span style=color:#75715e>// =&gt; &#39;https://example.com:8000&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>protocol</span> <span style=color:#75715e>// =&gt; &#39;https:&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>host</span> <span style=color:#75715e>// =&gt; &#39;example.com:8000&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>hostname</span> <span style=color:#75715e>// =&gt; &#39;example.com&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>port</span> <span style=color:#75715e>// =&gt; &#39;8000&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>pathname</span> <span style=color:#75715e>// =&gt; &#39;/path/name&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>search</span> <span style=color:#75715e>//=&gt; &#39;?q=term&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>hash</span> <span style=color:#75715e>// =&gt; &#39;#fragment&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>searchParams</span>.<span style=color:#a6e22e>append</span>(<span style=color:#e6db74>&#39;foo&#39;</span>, <span style=color:#e6db74>&#39;bar&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>toString</span>() <span style=color:#75715e>// =&gt; &#39;https://example.com:8000/path/name?q=term&amp;foo=bar#fragment&#39;
</span></span></span></code></pre></div><ul><li><code>encodeURI()</code>: 引数の文字列を URL エンコードして返す。<code>/</code>, <code>?</code>, <code>#</code> のような文字はエンコードしない。</li><li><code>decodeURI()</code>: 引数の文字列を URL デコードして返す。<code>/</code>, <code>?</code>, <code>#</code> のような文字はデコードしない。</li><li><code>encodeURIComponent()</code>: 引数の文字列を URL エンコードして返す。<code>/</code>, <code>?</code>, <code>#</code> のような文字もエンコードする。</li><li><code>decodeURIComponent()</code>: 引数の文字列を URL デコードして返す。<code>/</code>, <code>?</code>, <code>#</code> のような文字もデコードする。</li></ul><h3 id=1110-timers>11.10 Timers</h3><p><code>setTimeout(fn, timeout)</code> は、<code>timeout</code> 秒後に <code>fn</code> 関数を呼ぶ。<code>setInterval(fn, interval)</code> は、<code>interval</code> 秒間隔で <code>fn</code> 関数を呼ぶ。</p><h2 id=12-iterators-and-generators>12. Iterators and Generators</h2><h3 id=121-how-iterators-work>12.1 How Iterators Work</h3><p><code>for/of</code> ループやスプレッド演算子は、iterable オブジェクトに対して動く。iterable オブジェクトの <code>Symbol.iterator</code> プロパティは、iterator オブジェクトを返す。iterator オブジェクトに対して、<code>next()</code> メソッドを呼んで次の要素を取得していく。<code>next()</code> の返り値はオブジェクトで、<code>done</code> プロパティはループの終わりにのみ <code>true</code> になり、<code>value</code> プロパティは次の要素を返す。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>iterable</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>99</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>iterator</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>iterable</span>[<span style=color:#a6e22e>Symbol</span>.<span style=color:#a6e22e>iterator</span>]();
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>iterator</span>.<span style=color:#a6e22e>next</span>(); <span style=color:#f92672>!</span><span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>done</span>; <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>iterator</span>.<span style=color:#a6e22e>next</span>()) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>value</span>); <span style=color:#75715e>// 99
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><h3 id=122-implementing-iterable-objects>12.2 Implementing Iterable Objects</h3><p>itarable なクラスを作るためには、<code>Symbol.iterator</code> のメソッドを実装しなければならない。このメソッドは <code>next()</code> メソッドと <code>value</code>, <code>done</code> プロパティと実装しなければならない。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Range</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>from</span>, <span style=color:#a6e22e>to</span>) { <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>from</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>from</span>; <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>to</span><span style=color:#f92672>=</span> <span style=color:#a6e22e>to</span>; }
</span></span><span style=display:flex><span>  [<span style=color:#a6e22e>Symbol</span>.<span style=color:#a6e22e>iterator</span>]() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>next</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>ceil</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>from</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>last</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>to</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>next</span>() { <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>next</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>last</span>) <span style=color:#f92672>?</span> { <span style=color:#a6e22e>value</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>next</span><span style=color:#f92672>++</span> } <span style=color:#f92672>:</span> { <span style=color:#a6e22e>done</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span> }; }
</span></span><span style=display:flex><span>      [<span style=color:#a6e22e>Symbol</span>.<span style=color:#a6e22e>iterator</span>]() { <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>; } <span style=color:#75715e>// make the iterator itself iterable.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=123-generators>12.3 Generators</h3><p><em>ジェネレータ関数(generator function)</em> は、通常の関数と同様だが <code>function*</code> キーワードを使う。ジェネレータ関数を呼ぶと、実際にはジェネレータ関数の本体を実行せず、ジェネレータオブジェクト（イテレータ）を返す。<code>next()</code> メソッドを呼ぶと、ジェネレータ関数の本体を実行していって、<code>yield</code> 文まで達すると止まって、<code>yield</code> 文の値が <code>next()</code> の返り値になる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>oneDigitPrimes</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>yield</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>yield</span> <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>yield</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>yield</span> <span style=color:#ae81ff>7</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>primes</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>oneDigitPrimes</span>();
</span></span><span style=display:flex><span><span style=color:#a6e22e>primes</span>.<span style=color:#a6e22e>next</span>().<span style=color:#a6e22e>value</span> <span style=color:#75715e>// =&gt; 2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>primes</span>.<span style=color:#a6e22e>next</span>().<span style=color:#a6e22e>value</span> <span style=color:#75715e>// =&gt; 3
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>primes</span>.<span style=color:#a6e22e>next</span>().<span style=color:#a6e22e>value</span> <span style=color:#75715e>// =&gt; 5
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>primes</span>.<span style=color:#a6e22e>next</span>().<span style=color:#a6e22e>value</span> <span style=color:#75715e>// =&gt; 7
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>primes</span>.<span style=color:#a6e22e>next</span>().<span style=color:#a6e22e>done</span> <span style=color:#75715e>// =&gt; true
</span></span></span></code></pre></div><h3 id=124-advanced-generator-features>12.4 Advanced Generator Features</h3><ul><li>ジェネレータ関数が <code>return</code> で返した値は、ループが完了したあと（<code>done</code> が true になったとき）の <code>value</code> の値になる。</li><li><code>next()</code> 関数の引数の値が、ジェネレータ関数の <code>yield</code> の返り値になる。最初呼んだ <code>next()</code> の引数は捨てられる。</li><li>ジェネレータオブジェクトは <code>next()</code> 以外にも、<code>return()</code> と <code>throw()</code> メソッドがある。<code>return(value)</code> を呼ぶと、ジェネレータ関数内で <code>return value</code> したのと同じになる。<code>throw(error)</code> はジェネレータ関数内で <code>throw error</code> したのと同じになる。</li></ul><h2 id=13-asynchronous-javascript>13. Asynchronous JavaScript</h2><h3 id=131-asynchronous-programming-with-callbacks>13.1 Asynchronous Programming with Callbacks</h3><ul><li>一番シンプルな非同期処理は、<code>setTimeout()</code>, <code>setInterval()</code> 関数により一定時間後にあるコードを実行させることである。</li><li>クライアントサイド JavaScript プログラムではイベント駆動が遍在している。ユーザの入力などの特定イベントに対してコールバック関数を登録すると、ブラウザはそのイベントが発生したときにコールバック関数を呼ぶ。コールバック関数は <em>イベントハンドラ(event handler)</em> または <em>イベントリスナ(event listener)</em> といい、<code>addEventListener()</code> 関数で登録する。</li><li>別の非同期処理として、ネットワークリクエストがある。<code>XMLHttpRequest</code> クラス（または最近では <code>fetch()</code> 関数）を使って HTTP リクエストを送って、非同期に処理する。</li><li>Node.js サーバサイド環境では、多くの API がコールバックとイベントを使った非同期処理になっている。ファイル内容の読み込みも、デフォルトでは非同期で、内容が読み込まれたときにコールバック関数が呼ばれる。</li></ul><h3 id=132-promises>13.2 Promises</h3><p><em>プロミス(promise)</em> は、非同期処理の結果を表したオブジェクトである。プロミスはコールバックの扱い方を変えたものにすぎないが、コールバックベースの非同期プログラミングはコールバックの中にコールバックがあってインデントが深くなって読みづらくなる。プロミスはコールバックのネストを <em>プロミスチェーン(promise chain)</em> という形にして、より読みやすくなる。コールバックの別の問題はエラー処理が難しいことだが、プロミスはエラー処理をうまく扱う。</p><p>非同期処理をする関数はプロミスオブジェクトを返す。プロミスオブジェクトは <code>then(callback)</code>, <code>catch(callback)</code>, <code>finally(callback)</code> メソッドをメソッドチェーンさせて呼ぶことができて、非同期処理が解決したときに <code>then()</code> の <code>callback</code> が呼ばれ、非同期処理がエラーになったときに <code>catch()</code> の <code>callback</code> が呼ばれて、非同期処理が解決してもエラーになっても最後に <code>finally()</code> の <code>callback</code> が呼ばれる。<code>then()</code> のコールバックの返り値もプロミスオブジェクトなら、それもメソッドチェーンで <code>then()</code> で処理を続けられる。</p><p><code>Promise.all(promises)</code> 関数によって、複数のプロミスをまとめて非同期処理できる。複数のプロミスがすべて解決したときに <code>then()</code> が呼ばれる。</p><h3 id=133-async-and-await>13.3 async and await</h3><p>ES2017 では <code>async</code>, <code>await</code> という２つのキーワードが導入されて、プロミスベースの非同期コードが簡単に書けるようになった。</p><p><code>await</code> キーワードはプロミスオブジェクトを受け取って、非同期処理が解決するか拒否されるまで待って、その結果を返す。ただし <code>await</code> キーワードは、<code>async</code> キーワードで宣言された関数内でのみ使える。<code>async</code> な関数は、返り値が自動でプロミスになる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getHgihScore</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#34;/api/user/profile&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>profile</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>json</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>profile</span>.<span style=color:#a6e22e>highScore</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// In another async function:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>displayHighScore</span>(<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>getHighScore</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Or:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>getHighScore</span>().<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>displayHgihScore</span>).<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>);
</span></span></code></pre></div><p>複数のプロミスを並行して待つ場合、<code>Promise.all</code> を使う：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> [<span style=color:#a6e22e>value1</span>, <span style=color:#a6e22e>value2</span>] <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> Promise.<span style=color:#a6e22e>all</span>([<span style=color:#a6e22e>getJSON</span>(<span style=color:#a6e22e>url1</span>), <span style=color:#a6e22e>getJSON</span>(<span style=color:#a6e22e>url2</span>)]);
</span></span></code></pre></div><p><code>async</code> 関数は以下のように変換できる：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>f</span>(<span style=color:#a6e22e>x</span>) { ... }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>f</span>(<span style=color:#a6e22e>x</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Promise(<span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>rejct</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>resolve</span>((<span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>x</span>) { ... }(<span style=color:#a6e22e>x</span>)));
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>x</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>reject</span>(<span style=color:#a6e22e>e</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=134-asynchronous-iteration>13.4 Asynchronous Iteration</h3><p>ES2018 で、非同期イテレーションをサポートした。</p><p><code>for/async</code> ループ：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;fs&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>parseFile</span>(<span style=color:#a6e22e>filename</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>streeam</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>createReadStream</span>(<span style=color:#a6e22e>filename</span>, { <span style=color:#a6e22e>encoding</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;utf-8&#34;</span> });
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> <span style=color:#66d9ef>await</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>chunk</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>stream</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>parseChunk</span>(<span style=color:#a6e22e>chunk</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>非同期ジェネレータ：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span><span style=color:#f92672>*</span> <span style=color:#a6e22e>clock</span>(<span style=color:#a6e22e>interval</span>, <span style=color:#a6e22e>max</span><span style=color:#f92672>=</span><span style=color:#66d9ef>Infinity</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>count</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>count</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>max</span>; <span style=color:#a6e22e>count</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>new</span> Promise(<span style=color:#a6e22e>resolve</span> =&gt; <span style=color:#a6e22e>setTimeout</span>(<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>interval</span>));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>yield</span> <span style=color:#a6e22e>count</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>test</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> <span style=color:#66d9ef>await</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>tick</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>clock</span>(<span style=color:#ae81ff>300</span>, <span style=color:#ae81ff>100</span>)) <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>tick</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=14-metaprogramming>14. Metaprogramming</h2><h3 id=141-property-attributes>14.1 Property Attributes</h3><p>JavaScript オブジェクトのプロパティには３つの属性がある：</p><ul><li><p><em>writable</em>: プロパティの値を変更可能か。</p></li><li><p><em>enumerable</em>: プロパティが <code>for/in</code> ループや <code>Object.keys()</code> メソッドで列挙可能か。</p></li><li><p><em>configurable</em>: プロパティを削除できたりその属性を変更できたりするか。</p></li><li><p><code>Object.getOwnPropertyDescriptor(obj, propertyName)</code> は、指定したプロパティのデスクリプタ（属性情報）を取得する。</p></li><li><p><code>Object.defineProperty(obj, propertyName, descriptor)</code> は、指定したプロパティを定義する。</p></li></ul><h3 id=142-object-extensibility>14.2 Object Extensibility</h3><ul><li><code>Object.preventExtensions(obj)</code> は、オブジェクトを拡張不可能にする。拡張不可能にすると、新しいプロパティが追加できなくなる。</li><li><code>Object.seal(obj)</code> は、オブジェクトを拡張不可能にして、全プロパティを nonconfigurable にする。</li><li><code>Object.freeze(obj)</code> は、オブジェクトを拡張不可能にして、全プロパティを nonconfigurable/nonwritable にする。</li></ul><h3 id=143-the-prototype-attribute>14.3 The prototype Attribute</h3><ul><li><code>Object.getPrototypeOf(obj)</code> は、オブジェクトのプロトタイプを返す。</li><li><code>Object.setPrototypeOf(obj, prototype)</code> は、オブジェクトのプロトタイプをセットする。</li></ul><h3 id=144-well-known-symbols>14.4 Well-Known Symbols</h3><ul><li><code>Symbol.iterator</code></li><li><code>Symbol.asyncIterator</code></li><li><code>Symbol.hasInstance</code></li><li><code>Symbol.toStringTag</code></li><li><code>Symbol.species</code></li><li><code>Symbol.isConcatSpreadable</code></li><li><code>Symbol.toPriimtive</code></li><li><code>Symbol.unscopables</code></li></ul><h3 id=145-template-tags>14.5 Template Tags</h3><h3 id=146-the-reflect-api>14.6 The Reflect API</h3><h3 id=147-proxy-objects>14.7 Proxy Objects</h3><h2 id=15-javascript-in-web-browsers>15. JavaScript in Web Browsers</h2><h3 id=151-web-programming-basics>15.1 Web Programming Basics</h3><p>HTML 内の <code>&lt;script></code> タグによって、JavaScript を含むことができる。<code>defer</code> 属性を付けると、ドキュメントがロードされパースされて準備完了になるまで実行されない。<code>async</code> 属性を付けると、可能な限りスクリプトを実行るがドキュメントのパースはブロックしないようにする。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>defer</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;script.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span></code></pre></div><h3 id=152-events>15.2 Events</h3><h4 id=1521-event-categories>15.2.1 Event Categories</h4><ul><li>デバイス依存の入力イベント<ul><li>mousedown, mosemove, mouseup, touchstart, touchmove, touchend, keydown, keyup</li></ul></li><li>デバイス非依存の入力イベント<ul><li>click, input, pointerdown, pointermove, ppointerup</li></ul></li><li>UI イベント<ul><li>focus, change, submit</li></ul></li><li>状態変化イベント<ul><li>load, online, offline, popstate</li></ul></li><li>API 特有のイベント<ul><li>waiting, playing, seeking, volumechange, success, error</li></ul></li></ul><h4 id=1522-registering-event-handler>15.2.2 Registering Event Handler</h4><p>イベントハンドラの登録方法は２つある。１つ目に初期の Web からあるやり方は、イベントターゲットのイベントハンドラプロパティをセットすること。２つ目のやり方は、イベントターゲットの <code>addEventListener()</code> メソッドにハンドラを渡すこと。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;#mybutton&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>onclick</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>() { <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Thanks for clicking me!&#39;</span>); };
</span></span></code></pre></div><p>HTML 要素の属性として、イベントハンドラを直接セットすることもできる：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>onclick</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;console.log(&#39;THank you&#39;);&#34;</span>&gt;Please Click&lt;/<span style=color:#f92672>button</span>&gt;
</span></span></code></pre></div><p><code>addEventListener()</code> でイベントハンドラを登録した場合、クリーンアップとして <code>reomveEventListener()</code> でイベントハンドラを登録解除する：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;#mybutton&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handler</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Thanks again!&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;click&#39;</span>, <span style=color:#a6e22e>handler</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>removeEventListener</span>(<span style=color:#e6db74>&#39;click&#39;</span>, <span style=color:#a6e22e>handler</span>);
</span></span></code></pre></div><h4 id=1523-event-handler-invocation>15.2.3 Event Handler Invocation</h4><p>イベントが発生したとき、登録したイベントハンドラが Event オブジェクトを引数にして呼ばれる。Event オブジェクトは次のようなプロパティを持つ：</p><ul><li><code>type</code>: イベントのタイプ。</li><li><code>target</code>: イベントが発生したオブジェクト。イベントターゲット。</li><li><code>currentTarget</code>: イベントがプロパゲートしたとき、この値は現在のイベントハンドラが登録されたオブジェクトになる。</li><li><code>timeStamp</code>: イベントが発生した時刻。</li><li><code>isTrusted</code>: ブラウザが引き起こしたイベントなら <code>true</code>、JavaScript コードが引き起こしたイベントなら <code>false</code>。</li></ul><h4 id=1524-event-propagation>15.2.4 Event Propagation</h4><h4 id=1525-event-cancelation>15.2.5 Event Cancelation</h4><p>イベントハンドラで、Event の <code>preventDefault()</code> メソッドを呼ぶことで、ブラウザのデフォルト動作を抑止することができる。</p><h4 id=1526-dispatching-custom-events>15.2.6 Dispatching Custom Events</h4><p><code>CustomEvent</code> クラスで、独自のイベントオブジェクトを作ることがえきる。<code>dispatchEvent()</code> メソッドで、イベントを引き起こすことができる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>document.<span style=color:#a6e22e>dispatchEvent</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CustomEvent</span>(<span style=color:#e6db74>&#39;busy&#39;</span>, { <span style=color:#a6e22e>detail</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span> }));
</span></span><span style=display:flex><span>document.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;busy&#39;</span>, (<span style=color:#a6e22e>e</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>detail</span>) <span style=color:#a6e22e>showSpinner</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span> <span style=color:#a6e22e>hideSpinner</span>();
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h3 id=153-scripting-documents>15.3 Scripting Documents</h3><h3 id=154-scripting-css>15.4 Scripting CSS</h3><h3 id=155-document-geometry-and-scrolling>15.5 Document Geometry and Scrolling</h3><h3 id=156-web-components>15.6 Web Components</h3><h3 id=157-svg-scalable-vector-graphics>15.7 SVG: Scalable Vector Graphics</h3><h3 id=158-graphics-in-a-canvas>15.8 Graphics in a</h3><h3 id=159-audio-apis>15.9 Audio APIs</h3><h3 id=1510-location-navigation-and-history>15.10 Location, Navigation, and History</h3><h3 id=1511-networking>15.11 Networking</h3><h4 id=15111-fetch>15.11.1 fetch()</h4><p><code>fetch(url[, options])</code> 関数は、指定した URL をリクエストして、レスポンスを Promise で返す。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#39;/api/users&#39;</span>, {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;POST&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Headers</span>({<span style=color:#e6db74>&#39;Content-Type&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;application/json&#39;</span>, <span style=color:#e6db74>&#39;Authorization&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`Bearer </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>accessToken</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>}),
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>body</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>user</span>)
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>  .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>response</span> =&gt; <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>json</span>())
</span></span><span style=display:flex><span>  .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>user</span> =&gt; <span style=color:#a6e22e>displayUser</span>(<span style=color:#a6e22e>user</span>));
</span></span></code></pre></div><h4 id=15112-server-sent-events>15.11.2 Server-Sent Events</h4><p>サーバクライアント間でコネクションを開いたままにしておいて、サーバ側で何かイベントがあればクライアントに通知するという手法がある。クライアントサイド JavaScript でそれをサポートするため EventSource API がある。URL を引数にして <code>EventSource()</code> コンストラクタを呼ぶと、クライアントはその URL にリクエストを送ってコネクションを開いたままにしておいて、サーバがデータをコネクションに書き込んだとき、EventSource オブジェクトはそのデータをイベントに変換してイベントリスナに処理させる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>chat</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>EventSource</span>(<span style=color:#e6db74>&#39;/chat&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>chat</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;chat&#39;</span>, <span style=color:#a6e22e>event</span> =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>div</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;div&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>div</span>.<span style=color:#a6e22e>append</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>before</span>(<span style=color:#a6e22e>div</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>scrollIntoView</span>();
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h4 id=15113-websockets>15.11.3 WebSockets</h4><p><code>wss://</code> から始まる URL を引数に指定して <code>WebSocket()</code> コンストラクタを呼ぶと、WebSocket オブジェクトが作成される。</p><p>クライアントがサーバに WebSocket を通してメッセージを送るには、<code>WebSocket.prototype.send(data)</code> メソッドを使ってメッセージを送信する。</p><p>クライアントがサーバから WebSocket を通してメッセージを受け取るには、<code>onmessage</code> プロパティをセットするか <code>addEventListener('message', callback)</code> メソッドを呼ぶ。</p><h3 id=1512-storage>15.12 Storage</h3><h4 id=15121-localstorage-and-sessionstorage>15.12.1 localStorage and sessionStorage</h4><p><code>localStorage</code>, <code>sessionStorage</code> は普通の JavaScript オブジェクトと同様に働くが、プロパティの値は文字列でなければならず、プロパティは永続的に保存される。<code>localStorage</code>, <code>sessionStorage</code> は同じドキュメントオリジンでは同じ内容を共有する。<code>localStorage</code> は明示的に消されるまでずっと保存されるが、<code>sessionStorage</code> はブラウザ（のウィンドウやタブ）が閉じられると消える。</p><h4 id=15122-cookies>15.12.2 Cookies</h4><p><code>document.cookie</code> で Cookie を文字列で取得・変更できる。</p><h4 id=15123-indexeddb>15.12.3 IndexedDB</h4><p>IndexedDB はオブジェクトデータベースである。</p><h3 id=1513-worker-threads-and-messaging>15.13 Worker Threads and Messaging</h3><p>Worker クラスによってマルチスレッドを実現できる。</p><h2 id=16-server-side-javascript-with-node>16. Server-Side JavaScript with Node</h2><h3 id=161-node-programming-basics>16.1 Node Programming Basics</h3><p><code>console.log()</code> 関数は、標準出力に出力する。</p><p><code>process.argv</code> は文字列の配列で、第１要素は Node 実行可能ファイルのパス、第２要素は Node が実行している JavaScript コードのファイルパス、残りの要素はコマンドライン引数になる。</p><p><code>process.env</code> はオブジェクトで、プロパティ名が環境変数の名前、プロパティの値が環境変数の値になる。</p><p><code>process.exit()</code> 関数は、プログラムを終了する。</p><h3 id=162-node-is-asynchronous-by-default>16.2 Node Is Asynchronous by Default</h3><h3 id=163-buffers>16.3 Buffers</h3><h3 id=164-events-and-eventemitter>16.4 Events and EventEmitter</h3><h3 id=165-streams>16.5 Streams</h3><h3 id=166-process-cpu-and-operating-system-details>16.6 Process, CPU, and Operating System Details</h3><h3 id=167-working-with-files>16.7 Working with Files</h3><h3 id=168-http-clients-and-servers>16.8 HTTP Clients and Servers</h3><h3 id=169-non-http-network-servers-and-clients>16.9 Non-HTTP Network Servers and Clients</h3><h3 id=169-working-with-child-processes>16.9 Working with Child Processes</h3><h3 id=1610-worker-threads>16.10 Worker Threads</h3><h2 id=17-javascript-tools-and-extensions>17. JavaScript Tools and Extensions</h2><h3 id=171-linting-with-eslint>17.1 Linting with ESLint</h3><p>今日 JavaScript で最も使われている linter は <a href=https://eslint.org>ESLint</a> である。</p><h3 id=172-javascript-formatting-with-prettier>17.2 JavaScript Formatting with Prettier</h3><p><a href=https://prettier.io>Prettier</a> は、JavaScript のコードをパースして自動で整形する。</p><h3 id=173-unit-testing-with-jst>17.3 Unit Testing with Jst</h3><p>１つのパッケージの中に必要なものがすべて含まれている有名なテストフレームワークとして、<a href=https://jestjs.io>Jest</a> がある。</p><h3 id=174-pacakge-management-with-npm>17.4 Pacakge Management with npm</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ npm install express
</span></span><span style=display:flex><span>$ npm install --save-dev prettier
</span></span><span style=display:flex><span>$ npm install -g eslint jest
</span></span><span style=display:flex><span>$ npm audit --fix
</span></span></code></pre></div><h3 id=175-code-bundling>17.5 Code Bundling</h3><p><a href=https://webpack.js.org>webpack</a>, <a href=https://rollupjs.org/guide/en>Rollup</a>, <a href=https://parceljs.org>Parcel</a>。</p><h3 id=176-transpilation-with-babel>17.6 Transpilation with Babel</h3><p>[Babel])(<a href=https://babeljs.io>https://babeljs.io</a>)</p><h3 id=177-jsx-markup-expressions-in-javascript>17.7 JSX: Markup Expressions in JavaScript</h3><h3 id=178-type-checking-with-flow>17.8 Type Checking with Flow</h3><p><a href=https://flow.org>Flow</a></p></section></article><div class=column><div class="tags has-addons"><span class="tag is-dark">Created at</span>
<span class=tag><time datetime=2020-11-28T01:04:11+09:00>2020/11/28 01:04:11</time></span></div><div class="tags has-addons"><span class="tag is-dark">Tags</span>
<a href=/tags/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0 class="tag is-link">プログラミング</a></div></div></div></div></div><footer class=footer><div class="content has-text-centered"><p>Written by tn.</p><p>Generated by <a href=https://gohugo.io/>Hugo</a>.</p></div></footer></body></html>